var Xe=(W,H,ee)=>{if(!H.has(W))throw TypeError("Cannot "+ee)};var Se=(W,H,ee)=>{if(H.has(W))throw TypeError("Cannot add the same private member more than once");H instanceof WeakSet?H.add(W):H.set(W,ee)};var Q=(W,H,ee)=>(Xe(W,H,"access private method"),ee);(function(){"use strict";var fe,Ae,z,Z;class W{constructor(a){this.description=this.validateDescription(a),this.completionStatus=!1}validateDescription(a){if(typeof a!="string")throw new Error("Task description must be of type string");if(a=a.trim(),a.length===0)throw new Error("Task description invalid");return a}getDescription(){return this.description}setDescription(a){this.description=this.validateDescription(a)}isComplete(){return this.completionStatus}setCompletionStatus(a){if(typeof a!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=a}}class H{constructor(a,w){this.username=this.validateUsername(a),this.nameColor=(w==null?void 0:w.nameColor)||"",this.tasks=[]}validateUsername(a){if(typeof a!="string")throw new Error("Username must be of type string");if(a=a.trim(),a.length===0)throw new Error("Username invalid");return a}addTask(a){return this.tasks.push(a),a}editTask(a,w){let c=this.getTask(a);return c.setDescription(w),c}completeTask(a){let w=this.getTask(a);return w.setCompletionStatus(!0),w}deleteTask(a){Array.isArray(a)||(a=[a]),a.forEach(c=>this.validateTaskIndex(c));const w=[];return this.tasks=this.tasks.filter((c,k)=>{if(a.includes(k))w.push(c);else return!0}),w}clearDoneTasks(){return this.tasks=this.tasks.filter(a=>!a.isComplete()),this.tasks}getTask(a){return this.validateTaskIndex(a),this.tasks[a]}getTasks(){return this.tasks}validateTaskIndex(a){if(typeof a!="number"||isNaN(a))throw new Error("Task index must be a number");if(a<0||a>=this.tasks.length)throw new Error("Task index out of bounds");return!0}}class ee{constructor(){Se(this,fe);Se(this,z);this.users=Q(this,fe,Ae).call(this)}getUser(a){return this.users.find(c=>c.username===a)}getAllUsers(){return this.users}createUser(a,w){if(this.getUser(a))throw new Error(`${a} already exists`);const c=new H(a,w);return this.users.push(c),c}addUserTasks(a,w){let c=this.getUser(a);if(!c)throw new Error(`${a} does not exist`);return Array.isArray(w)||(w=[w]),w.forEach(k=>c.addTask(new W(k))),Q(this,z,Z).call(this),w}editUserTask(a,w,c){const k=this.getUser(a);if(!k)throw new Error(`${a} has no tasks`);return k.editTask(w,c),Q(this,z,Z).call(this),c}completeUserTasks(a,w){const c=this.getUser(a);if(!c)throw new Error(`${a} has no tasks`);Array.isArray(w)||(w=[w]);const k=w.map(C=>c.completeTask(C).description);return Q(this,z,Z).call(this),k}deleteUserTasks(a,w){const c=this.getUser(a);if(!c)throw new Error(`${a} has no tasks`);Array.isArray(w)||(w=[w]);const k=c.deleteTask(w).map(C=>C.description);return Q(this,z,Z).call(this),k}checkUserTasks(a){const w=this.getUser(a);if(!w)throw new Error(`${a} has no tasks`);return w.getTasks().filter(c=>!c.isComplete()).map(c=>c.getDescription())}clearUserList(){this.users=[],Q(this,z,Z).call(this)}clearDoneTasks(){this.users.forEach(a=>{a.clearDoneTasks()}),Q(this,z,Z).call(this)}deleteUser(a){const w=this.users.findIndex(k=>k.username===a);if(w===-1)throw new Error(`${a} not found`);const c=this.users[w];return this.users.splice(w,1),Q(this,z,Z).call(this),c}}fe=new WeakSet,Ae=function(){let a=localStorage.getItem("userList");return a?(a=JSON.parse(a),a.map(c=>{const k=new H(c.username,{nameColor:c.nameColor});return c.tasks.map(C=>{k.addTask(new W(C.description)).setCompletionStatus(C.completionStatus)}),k})):(a=[],localStorage.setItem("userList",JSON.stringify(a)),a)},z=new WeakSet,Z=function(){localStorage.setItem("userList",JSON.stringify(this.users))};function Re(){const S=document.querySelector(":root");for(let[a,w]of Object.entries(configs.styles))a.includes("FontFamily")&&Pe(w),S.style.setProperty(Me(a),w)}function Pe(S){WebFont.load({google:{families:[`${S}:100,400,700`]}})}function Me(S){return`--${S.replace(/([A-Z])/g,"-$1").toLowerCase()}`}let ie,be;function xe(){const a=document.querySelector(".task-wrapper").clientHeight,w=document.querySelector(".task-container.primary"),c=w.scrollHeight,k=document.querySelector(".task-container.secondary");if(c<a)k.style.display="none",Ne();else{k.style.display="flex";const C=configs.settings.scrollSpeed;let v=parseInt(C,10),s={duration:c/v*1e3,iterations:1,easing:"linear"};const l=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);let p=c+parseInt(l,10),t=[{transform:"translateY(0)"},{transform:`translateY(-${p}px)`}],i=[{transform:"translateY(0)"},{transform:`translateY(-${p}px)`}];ie=w.animate(t,s),be=k.animate(i,s),je()}}function Ne(){ie&&ie.cancel(),be&&be.cancel()}function je(){ie&&(ie.addEventListener("finish",Ee),ie.addEventListener("cancel",Ee))}function Ee(){xe()}function le(S){const a=document.createDocumentFragment();let w=0,c=0;S.forEach(s=>{const l=document.createElement("div");l.classList.add("card");const p=document.createElement("div");p.classList.add("username"),p.innerText=s.username,p.style.color=configs.settings.showUsernameColor?s.nameColor:"",l.appendChild(p);const t=document.createElement("ol");t.classList.add("tasks"),s.tasks.forEach(i=>{const f=document.createElement("li");f.classList.add("task"),f.innerText=i.description,i.completionStatus&&(f.classList.add("done"),c++),w++,t.appendChild(f)}),l.appendChild(t),a.appendChild(l)});const k=document.querySelector(".task-count");k.innerText=`${c}/${w}`;const C=a.cloneNode(!0),v=document.querySelector(".task-container.primary");v.innerHTML="",v.appendChild(a);const _=document.querySelector(".task-container.secondary");_.innerHTML="",_.appendChild(C),xe()}function Ue(){const S=[];for(let a=1;a<=6;a++){const w=`Username${a}`,c=["red","royalBlue","springGreen","lightSeaGreen","goldenRod","violet"],k=c[Math.floor(Math.random()*c.length)],C={username:w,nameColor:k,tasks:[{description:"Task 1 description",completionStatus:!0},{description:"This is task 2 description",completionStatus:!0},{description:"This description is a longer description task",completionStatus:!1}]};S.push(C)}return S}var he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $e(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var Ie={exports:{}};function de(S){throw new Error('Could not dynamically require "'+S+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ge={};(function S(a,w,c){function k(_,s){if(!w[_]){if(!a[_]){var l=typeof de=="function"&&de;if(!s&&l)return l(_,!0);if(C)return C(_,!0);throw(l=new Error("Cannot find module '"+_+"'")).code="MODULE_NOT_FOUND",l}l=w[_]={exports:{}},a[_][0].call(l.exports,function(p){return k(a[_][1][p]||p)},l,l.exports,S,a,w,c)}return w[_].exports}for(var C=typeof de=="function"&&de,v=0;v<c.length;v++)k(c[v]);return k})({1:[function(S,a,w){S=S("./lib/client"),a.exports={client:S,Client:S}},{"./lib/client":3}],2:[function(S,a,w){function c(_,s){var l,p=Object.keys(_);return Object.getOwnPropertySymbols&&(l=Object.getOwnPropertySymbols(_),s&&(l=l.filter(function(t){return Object.getOwnPropertyDescriptor(_,t).enumerable})),p.push.apply(p,l)),p}function k(_){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?c(Object(l),!0).forEach(function(p){var t,i;t=_,p=l[i=p],i in t?Object.defineProperty(t,i,{value:p,enumerable:!0,configurable:!0,writable:!0}):t[i]=p}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(l)):c(Object(l)).forEach(function(p){Object.defineProperty(_,p,Object.getOwnPropertyDescriptor(l,p))})}return _}var C=S("node-fetch"),v=S("./utils");a.exports=function(_,s){var l=_.url!==void 0?_.url:_.uri;if(v.isURL(l)||(l="https://api.twitch.tv/kraken".concat(l[0]==="/"?l:"/".concat(l))),v.isNode()){var p=Object.assign({method:"GET",json:!0},_);p.qs&&(t=new URLSearchParams(p.qs),l+="?".concat(t));var t={};"fetchAgent"in this.opts.connection&&(t.agent=this.opts.connection.fetchAgent);var t=C(l,k(k({},t),{},{method:p.method,headers:p.headers,body:p.body})),i={};t.then(function(n){return i={statusCode:n.status,headers:n.headers},p.json?n.json():n.text()}).then(function(n){return s(null,i,n)},function(n){return s(n,i,null)})}else{var f,o=Object.assign({method:"GET",headers:{}},_,{url:l}),r=new XMLHttpRequest;for(f in r.open(o.method,o.url,!0),o.headers)r.setRequestHeader(f,o.headers[f]);r.responseType="json",r.addEventListener("load",function(n){r.readyState===4&&(r.status!==200?s(r.status,null,null):s(null,null,r.response))}),r.send()}}},{"./utils":9,"node-fetch":10}],3:[function(S,a,w){(function(c){(function(){function k(e,u){var h,d=Object.keys(e);return Object.getOwnPropertySymbols&&(h=Object.getOwnPropertySymbols(e),u&&(h=h.filter(function(g){return Object.getOwnPropertyDescriptor(e,g).enumerable})),d.push.apply(d,h)),d}function C(e){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?k(Object(h),!0).forEach(function(d){var g,D;g=e,d=h[D=d],D in g?Object.defineProperty(g,D,{value:d,enumerable:!0,configurable:!0,writable:!0}):g[D]=d}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(h)):k(Object(h)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(h,d))})}return e}function v(e){return function(u){if(Array.isArray(u))return _(u)}(e)||function(u){if(typeof Symbol<"u"&&u[Symbol.iterator]!=null||u["@@iterator"]!=null)return Array.from(u)}(e)||function(u,h){if(u){if(typeof u=="string")return _(u,h);var d=Object.prototype.toString.call(u).slice(8,-1);return(d=d==="Object"&&u.constructor?u.constructor.name:d)==="Map"||d==="Set"?Array.from(u):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?_(u,h):void 0}}(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _(e,u){(u==null||u>e.length)&&(u=e.length);for(var h=0,d=new Array(u);h<u;h++)d[h]=e[h];return d}function s(e){if(!(this instanceof s))return new s(e);this.opts=y.get(e,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=y.get(this.opts.options.clientId,null),this._globalDefaultChannel=y.channel(y.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=y.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=y.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=y.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=y.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=y.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=y.get(this.opts.connection.reconnect,!0),this.reconnectDecay=y.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=y.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=y.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null,e="error",this.opts.options.debug&&(e="info"),this.log=this.opts.logger||n;try{n.setLevel(e)}catch{}this.opts.channels.forEach(function(u,h,d){return d[h]=y.channel(u)}),r.call(this),this.setMaxListeners(0)}var l,p=c!==void 0?c:typeof window<"u"?window:{},t=p.WebSocket||S("ws"),i=p.fetch||S("node-fetch"),f=S("./api"),o=S("./commands"),r=S("./events").EventEmitter,n=S("./logger"),m=S("./parser"),T=S("./timer"),y=S("./utils"),E=!1;for(l in y.inherits(s,r),o)s.prototype[l]=o[l];s.prototype.emits=function(e,u){for(var h=0;h<e.length;h++){var d=h<u.length?u[h]:u[u.length-1];this.emit.apply(this,[e[h]].concat(d))}},s.prototype.api=function(){E||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),E=!0),f.apply(void 0,arguments)},s.prototype.handleMessage=function(e){var u=this;if(e){this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);var h,d,g,D,A,R,L,j,U,b=y.channel(y.get(e.params[0],null)),x=y.get(e.params[1],null),M=y.get(e.tags["msg-id"],null),I=e.tags=m.badges(m.badgeInfo(m.emotes(e.tags)));for(h in I)h!=="emote-sets"&&h!=="ban-duration"&&h!=="bits"&&(typeof(d=I[h])=="boolean"?d=null:d==="1"?d=!0:d==="0"?d=!1:typeof d=="string"&&(d=y.unescapeIRC(d)),I[h]=d);if(e.prefix===null)switch(e.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":var ke=new Date;this.currentLatency=(ke.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn(`Could not parse message with no prefix:
`.concat(JSON.stringify(e,null,4)))}else if(e.prefix==="tmi.twitch.tv")switch(e.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=e.params[0];break;case"376":this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(function(){u._isConnected()&&u.ws.send("PING"),u.latency=new Date,u.pingTimeout=setTimeout(function(){u.ws!==null&&(u.wasCloseCalled=!1,u.log.error("Ping timeout."),u.ws.close(),clearInterval(u.pingLoop),clearTimeout(u.pingTimeout),clearTimeout(u._updateEmotesetsTimer))},y.get(u.opts.connection.timeout,9999))},6e4);var ae=y.get(this.opts.options.joinInterval,2e3),pe=new T(ae=ae<300?300:ae),ge=v(new Set([].concat(v(this.opts.channels),v(this.channels))));this.channels=[];for(var ue=0;ue<ge.length;ue++)(function(B){var Ye=ge[B];pe.add(function(){u._isConnected()&&u.join(Ye).catch(function(Qe){return u.log.error(Qe)})})})(ue);pe.next();break;case"NOTICE":var G=[null],F=[b,M,x],K=[b,!0],V=[b,!1],$=[F,G],P=[F,[M]],O="[".concat(b,"] ").concat(x);switch(M){case"subs_on":this.log.info("[".concat(b,"] This room is now in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribers"],[K,K,G]);break;case"subs_off":this.log.info("[".concat(b,"] This room is no longer in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[V,V,G]);break;case"emote_only_on":this.log.info("[".concat(b,"] This room is now in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonly"],[K,G]);break;case"emote_only_off":this.log.info("[".concat(b,"] This room is no longer in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonlyoff"],[V,G]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info("[".concat(b,"] This room is now in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[K,K,G]);break;case"r9k_off":this.log.info("[".concat(b,"] This room is no longer in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[V,V,G]);break;case"room_mods":var te=x.split(": "),te=(1<te.length?te[1]:"").toLowerCase().split(", ").filter(function(B){return B});this.emits(["_promiseMods","mods"],[[null,te],[b,te]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[b,[]]]);break;case"vips_success":var ne=(x=x.endsWith(".")?x.slice(0,-1):x).split(": "),ne=(1<ne.length?ne[1]:"").toLowerCase().split(", ").filter(function(B){return B});this.emits(["_promiseVips","vips"],[[null,ne],[b,ne]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[b,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(O),this.emits(["notice","_promiseBan"],P);break;case"ban_success":this.log.info(O),this.emits(["notice","_promiseBan"],$);break;case"usage_clear":this.log.info(O),this.emits(["notice","_promiseClear"],P);break;case"usage_mods":this.log.info(O),this.emits(["notice","_promiseMods"],[F,[M,[]]]);break;case"mod_success":this.log.info(O),this.emits(["notice","_promiseMod"],$);break;case"usage_vips":this.log.info(O),this.emits(["notice","_promiseVips"],[F,[M,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(O),this.emits(["notice","_promiseVip"],[F,[M,[]]]);break;case"vip_success":this.log.info(O),this.emits(["notice","_promiseVip"],$);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(O),this.emits(["notice","_promiseMod"],P);break;case"unmod_success":this.log.info(O),this.emits(["notice","_promiseUnmod"],$);break;case"unvip_success":this.log.info(O),this.emits(["notice","_promiseUnvip"],$);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(O),this.emits(["notice","_promiseUnmod"],P);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(O),this.emits(["notice","_promiseUnvip"],P);break;case"color_changed":this.log.info(O),this.emits(["notice","_promiseColor"],$);break;case"usage_color":case"turbo_only_color":this.log.info(O),this.emits(["notice","_promiseColor"],P);break;case"commercial_success":this.log.info(O),this.emits(["notice","_promiseCommercial"],$);break;case"usage_commercial":case"bad_commercial_error":this.log.info(O),this.emits(["notice","_promiseCommercial"],P);break;case"hosts_remaining":this.log.info(O),ne=isNaN(x[0])?0:parseInt(x[0]),this.emits(["notice","_promiseHost"],[F,[null,~~ne]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(O),this.emits(["notice","_promiseHost"],[F,[M,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(O),this.emits(["notice","_promiseR9kbeta"],P);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(O),this.emits(["notice","_promiseR9kbetaoff"],P);break;case"timeout_success":this.log.info(O),this.emits(["notice","_promiseTimeout"],$);break;case"delete_message_success":this.log.info("[".concat(b," ").concat(x,"]")),this.emits(["notice","_promiseDeletemessage"],$);break;case"already_subs_off":case"usage_subs_off":this.log.info(O),this.emits(["notice","_promiseSubscribersoff"],P);break;case"already_subs_on":case"usage_subs_on":this.log.info(O),this.emits(["notice","_promiseSubscribers"],P);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(O),this.emits(["notice","_promiseEmoteonlyoff"],P);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(O),this.emits(["notice","_promiseEmoteonly"],P);break;case"usage_slow_on":this.log.info(O),this.emits(["notice","_promiseSlow"],P);break;case"usage_slow_off":this.log.info(O),this.emits(["notice","_promiseSlowoff"],P);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(O),this.emits(["notice","_promiseTimeout"],P);break;case"untimeout_success":case"unban_success":this.log.info(O),this.emits(["notice","_promiseUnban"],$);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(O),this.emits(["notice","_promiseUnban"],P);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(O),this.emits(["notice","_promiseDeletemessage"],P);break;case"usage_unhost":case"not_hosting":this.log.info(O),this.emits(["notice","_promiseUnhost"],P);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(O),this.emits(["notice","_promiseWhisper"],P);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(O),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[F,[M,b]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(O),this.emit("automod",b,M,x);break;case"unrecognized_cmd":this.log.info(O),this.emit("notice",b,M,x);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(O),this.emit("notice",b,M,x);break;case"host_on":case"host_off":break;default:x.includes("Login unsuccessful")||x.includes("Login authentication failed")||x.includes("Error logging in")||x.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=x,this.log.error(this.reason),this.ws.close()):x.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
`.concat(JSON.stringify(e,null,4))),this.emit("notice",b,M,x))}break;case"USERNOTICE":var Y=I["display-name"]||I.login,ae=I["msg-param-sub-plan"]||"",ce=y.unescapeIRC(y.get(I["msg-param-sub-plan-name"],""))||null,se={prime:ae.includes("Prime"),plan:ae,planName:ce},Ce=~~(I["msg-param-streak-months"]||0),Oe=I["msg-param-recipient-display-name"]||I["msg-param-recipient-user-name"],Le=~~I["msg-param-mass-gift-count"];switch(I["message-type"]=M){case"resub":this.emits(["resub","subanniversary"],[[b,Y,Ce,x,I,se]]);break;case"sub":this.emits(["subscription","sub"],[[b,Y,se,x,I]]);break;case"subgift":this.emit("subgift",b,Y,Ce,Oe,se,I);break;case"anonsubgift":this.emit("anonsubgift",b,Ce,Oe,se,I);break;case"submysterygift":this.emit("submysterygift",b,Y,Le,se,I);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",b,Le,se,I);break;case"primepaidupgrade":this.emit("primepaidupgrade",b,Y,se,I);break;case"giftpaidupgrade":var Te=I["msg-param-sender-name"]||I["msg-param-sender-login"];this.emit("giftpaidupgrade",b,Y,Te,I);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",b,Y,I);break;case"raid":var Te=I["msg-param-displayName"]||I["msg-param-login"],_e=+I["msg-param-viewerCount"];this.emit("raided",b,Te,_e,I);break;case"ritual":_e=I["msg-param-ritual-name"],_e==="new_chatter"?this.emit("newchatter",b,Y,I,x):this.emit("ritual",_e,b,Y,I,x);break;default:this.emit("usernotice",M,b,I,x)}break;case"HOSTTARGET":var ce=x.split(" "),me=~~ce[1]||0;ce[0]==="-"?(this.log.info("[".concat(b,"] Exited host mode.")),this.emits(["unhost","_promiseUnhost"],[[b,me],[null]])):(this.log.info("[".concat(b,"] Now hosting ").concat(ce[0]," for ").concat(me," viewer(s).")),this.emit("hosting",b,ce[0],me));break;case"CLEARCHAT":1<e.params.length?(g=y.get(e.tags["ban-duration"],null))===null?(this.log.info("[".concat(b,"] ").concat(x," has been banned.")),this.emit("ban",b,x,null,e.tags)):(this.log.info("[".concat(b,"] ").concat(x," has been timed out for ").concat(g," seconds.")),this.emit("timeout",b,x,null,~~g,e.tags)):(this.log.info("[".concat(b,"] Chat was cleared by a moderator.")),this.emits(["clearchat","_promiseClear"],[[b],[null]]));break;case"CLEARMSG":1<e.params.length&&(me=x,g=I.login,I["message-type"]="messagedeleted",this.log.info("[".concat(b,"] ").concat(g,"'s message has been deleted.")),this.emit("messagedeleted",b,g,me,I));break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.disconnect().catch(function(B){return u.log.error(B)}),setTimeout(function(){return u.connect().catch(function(B){return u.log.error(B)})},this.reconnectTimer);break;case"USERSTATE":e.tags.username=this.username,e.tags["user-type"]==="mod"&&(this.moderators[b]||(this.moderators[b]=[]),this.moderators[b].includes(this.username)||this.moderators[b].push(this.username)),y.isJustinfan(this.getUsername())||this.userstate[b]||(this.userstate[b]=I,this.lastJoined=b,this.channels.push(b),this.log.info("Joined ".concat(b)),this.emit("join",b,y.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[b]=I;break;case"GLOBALUSERSTATE":this.globaluserstate=I,this.emit("globaluserstate",I),e.tags["emote-sets"]!==void 0&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":y.channel(this.lastJoined)===b&&this.emit("_promiseJoin",null,b),e.tags.channel=b,this.emit("roomstate",b,e.tags),y.hasOwn(e.tags,"subs-only")||(y.hasOwn(e.tags,"slow")&&(typeof e.tags.slow!="boolean"||e.tags.slow?(D=[b,!0,~~e.tags.slow],this.log.info("[".concat(b,"] This room is now in slow mode.")),this.emits(["slow","slowmode","_promiseSlow"],[D,D,[null]])):(D=[b,!1,0],this.log.info("[".concat(b,"] This room is no longer in slow mode.")),this.emits(["slow","slowmode","_promiseSlowoff"],[D,D,[null]]))),y.hasOwn(e.tags,"followers-only")&&(e.tags["followers-only"]==="-1"?(A=[b,!1,0],this.log.info("[".concat(b,"] This room is no longer in followers-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[A,A,[null]])):(A=[b,!0,~~e.tags["followers-only"]],this.log.info("[".concat(b,"] This room is now in follower-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowers"],[A,A,[null]]))));break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
`.concat(JSON.stringify(e,null,4)))}else if(e.prefix==="jtv")e.command==="MODE"?x==="+o"?(this.moderators[b]||(this.moderators[b]=[]),this.moderators[b].includes(e.params[2])||this.moderators[b].push(e.params[2]),this.emit("mod",b,e.params[2])):x==="-o"&&(this.moderators[b]||(this.moderators[b]=[]),this.moderators[b].filter(function(B){return B!==e.params[2]}),this.emit("unmod",b,e.params[2])):this.log.warn(`Could not parse message from jtv:
`.concat(JSON.stringify(e,null,4)));else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":var X=e.prefix.split("!")[0];y.isJustinfan(this.getUsername())&&this.username===X&&(this.lastJoined=b,this.channels.push(b),this.log.info("Joined ".concat(b)),this.emit("join",b,X,!0)),this.username!==X&&this.emit("join",b,X,!1);break;case"PART":var oe=!1,De=e.prefix.split("!")[0];this.username===De&&(oe=!0,this.userstate[b]&&delete this.userstate[b],(X=this.channels.indexOf(b))!==-1&&this.channels.splice(X,1),(X=this.opts.channels.indexOf(b))!==-1&&this.opts.channels.splice(X,1),this.log.info("Left ".concat(b)),this.emit("_promisePart",null)),this.emit("part",b,De,oe);break;case"WHISPER":oe=e.prefix.split("!")[0],this.log.info("[WHISPER] <".concat(oe,">: ").concat(x)),y.hasOwn(e.tags,"username")||(e.tags.username=oe),e.tags["message-type"]="whisper",oe=y.channel(e.tags.username),this.emits(["whisper","message"],[[oe,e.tags,x,!1]]);break;case"PRIVMSG":e.tags.username=e.prefix.split("!")[0],e.tags.username==="jtv"?(L=y.username(x.split(" ")[0]),j=x.includes("auto"),x.includes("hosting you for")?(R=y.extractNumber(x),this.emit("hosted",b,L,R,j)):x.includes("hosting you")&&this.emit("hosted",b,L,0,j)):(R=y.get(this.opts.options.messagesLogLevel,"info"),L=y.actionMessage(x),e.tags["message-type"]=L?"action":"chat",x=L?L[1]:x,y.hasOwn(e.tags,"bits")?this.emit("cheer",b,e.tags,x):(y.hasOwn(e.tags,"msg-id")?e.tags["msg-id"]==="highlighted-message"?(j=e.tags["msg-id"],this.emit("redeem",b,e.tags.username,j,e.tags,x)):e.tags["msg-id"]==="skip-subs-mode-message"&&(U=e.tags["msg-id"],this.emit("redeem",b,e.tags.username,U,e.tags,x)):y.hasOwn(e.tags,"custom-reward-id")&&(U=e.tags["custom-reward-id"],this.emit("redeem",b,e.tags.username,U,e.tags,x)),L?(this.log[R]("[".concat(b,"] *<").concat(e.tags.username,">: ").concat(x)),this.emits(["action","message"],[[b,e.tags,x,!1]])):(this.log[R]("[".concat(b,"] <").concat(e.tags.username,">: ").concat(x)),this.emits(["chat","message"],[[b,e.tags,x,!1]]))));break;default:this.log.warn(`Could not parse message:
`.concat(JSON.stringify(e,null,4)))}}},s.prototype.connect=function(){var e=this;return new Promise(function(u,h){e.server=y.get(e.opts.connection.server,"irc-ws.chat.twitch.tv"),e.port=y.get(e.opts.connection.port,80),e.secure&&(e.port=443),e.port===443&&(e.secure=!0),e.reconnectTimer=e.reconnectTimer*e.reconnectDecay,e.reconnectTimer>=e.maxReconnectInterval&&(e.reconnectTimer=e.maxReconnectInterval),e._openConnection(),e.once("_promiseConnect",function(d){d?h(d):u([e.server,~~e.port])})})},s.prototype._openConnection=function(){var e="".concat(this.secure?"wss":"ws","://").concat(this.server,":").concat(this.port,"/"),u={};"agent"in this.opts.connection&&(u.agent=this.opts.connection.agent),this.ws=new t(e,"irc",u),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},s.prototype._onOpen=function(){var e=this;this._isConnected()&&(this.log.info("Connecting to ".concat(this.server," on port ").concat(this.port,"..")),this.emit("connecting",this.server,~~this.port),this.username=y.get(this.opts.identity.username,y.justinfan()),this._getToken().then(function(u){var h=y.password(u);e.log.info("Sending authentication to server.."),e.emit("logon"),u="twitch.tv/tags twitch.tv/commands",e._skipMembership||(u+=" twitch.tv/membership"),e.ws.send("CAP REQ :"+u),h?e.ws.send("PASS ".concat(h)):y.isJustinfan(e.username)&&e.ws.send("PASS SCHMOOPIIE"),e.ws.send("NICK ".concat(e.username))}).catch(function(u){e.emits(["_promiseConnect","disconnected"],[[u],["Could not get a token."]])}))},s.prototype._getToken=function(){var e,u=this.opts.identity.password;return typeof u=="function"?(e=u())instanceof Promise?e:Promise.resolve(e):Promise.resolve(u)},s.prototype._onMessage=function(e){var u=this;e.data.trim().split(`\r
`).forEach(function(h){h=m.msg(h),h&&u.handleMessage(h)})},s.prototype._onError=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect().catch(function(u){return e.log.error(u)})},this.reconnectTimer)),this.ws=null},s.prototype._onClose=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect().catch(function(u){return e.log.error(u)})},this.reconnectTimer))),this.ws=null},s.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},s.prototype._sendCommand=function(e,u,h,d){var g=this;return new Promise(function(D,A){if(!g._isConnected())return A("Not connected to server.");var R;e!==null&&typeof e!="number"||(e===null&&(e=g._getPromiseDelay()),y.promiseDelay(e).then(function(){return A("No response from Twitch.")})),u!==null?(R=y.channel(u),g.log.info("[".concat(R,"] Executing command: ").concat(h)),g.ws.send("PRIVMSG ".concat(R," :").concat(h))):(g.log.info("Executing command: ".concat(h)),g.ws.send(h)),typeof d=="function"?d(D,A):D()})},s.prototype._sendMessage=function(e,u,h,d){var g=this;return new Promise(function(D,A){if(!g._isConnected())return A("Not connected to server.");if(y.isJustinfan(g.getUsername()))return A("Cannot send anonymous messages.");var R,L=y.channel(u);g.userstate[L]||(g.userstate[L]={}),500<=h.length&&(R=y.splitLine(h,500),h=R[0],setTimeout(function(){g._sendMessage(e,u,R[1],function(){})},350)),g.ws.send("PRIVMSG ".concat(L," :").concat(h));var j={};Object.keys(g.emotesets).forEach(function(M){return g.emotesets[M].forEach(function(I){return(y.isRegex(I.code)?m.emoteRegex:m.emoteString)(h,I.code,I.id,j)})});var U=Object.assign(g.userstate[L],m.emotes({emotes:m.transformEmotes(j)||null})),b=y.get(g.opts.options.messagesLogLevel,"info"),x=y.actionMessage(h);x?(U["message-type"]="action",g.log[b]("[".concat(L,"] *<").concat(g.getUsername(),">: ").concat(x[1])),g.emits(["action","message"],[[L,U,x[1],!0]])):(U["message-type"]="chat",g.log[b]("[".concat(L,"] <").concat(g.getUsername(),">: ").concat(h)),g.emits(["chat","message"],[[L,U,h,!0]])),typeof d=="function"?d(D,A):D()})},s.prototype._updateEmoteset=function(e){var u,h=this,d=e!==void 0;d&&(e===this.emotes?d=!1:this.emotes=e),this._skipUpdatingEmotesets?d&&this.emit("emotesets",e,{}):(u=function(){0<h._updateEmotesetsTimerDelay&&(clearTimeout(h._updateEmotesetsTimer),h._updateEmotesetsTimer=setTimeout(function(){return h._updateEmoteset(e)},h._updateEmotesetsTimerDelay))},this._getToken().then(function(g){var D="https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=".concat(e),A={};return"fetchAgent"in h.opts.connection&&(A.agent=h.opts.connection.fetchAgent),i(D,C(C({},A),{},{headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:"OAuth ".concat(y.token(g)),"Client-ID":h.clientId}}))}).then(function(g){return g.json()}).then(function(g){h.emotesets=g.emoticon_sets||{},h.emit("emotesets",e,h.emotesets),u()}).catch(u))},s.prototype.getUsername=function(){return this.username},s.prototype.getOptions=function(){return this.opts},s.prototype.getChannels=function(){return this.channels},s.prototype.isMod=function(e,u){return e=y.channel(e),this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(y.username(u))},s.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},s.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},s.prototype.disconnect=function(){var e=this;return new Promise(function(u,h){e.ws!==null&&e.ws.readyState!==3?(e.wasCloseCalled=!0,e.log.info("Disconnecting from server.."),e.ws.close(),e.once("_promiseDisconnect",function(){return u([e.server,~~e.port])})):(e.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),h("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},s.prototype.off=s.prototype.removeListener,a!==void 0&&a.exports&&(a.exports=s),typeof window<"u"&&(window.tmi={client:s,Client:s})}).call(this)}).call(this,typeof he<"u"?he:typeof self<"u"?self:typeof window<"u"?window:{})},{"./api":2,"./commands":4,"./events":5,"./logger":6,"./parser":7,"./timer":8,"./utils":9,"node-fetch":10,ws:10}],4:[function(S,a,w){var c=S("./utils");function k(t,i){var f=this;return t=c.channel(t),i=c.get(i,30),this._sendCommand(null,t,"/followers ".concat(i),function(o,r){f.once("_promiseFollowers",function(n){n?r(n):o([t,~~i])})})}function C(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/followersoff",function(f,o){i.once("_promiseFollowersoff",function(r){r?o(r):f([t])})})}function v(t){var i=this;return t=c.channel(t),this._sendCommand(null,null,"PART ".concat(t),function(f,o){i.once("_promisePart",function(r){r?o(r):f([t])})})}function _(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/r9kbeta",function(f,o){i.once("_promiseR9kbeta",function(r){r?o(r):f([t])})})}function s(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/r9kbetaoff",function(f,o){i.once("_promiseR9kbetaoff",function(r){r?o(r):f([t])})})}function l(t,i){var f=this;return t=c.channel(t),i=c.get(i,300),this._sendCommand(null,t,"/slow ".concat(i),function(o,r){f.once("_promiseSlow",function(n){n?r(n):o([t,~~i])})})}function p(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/slowoff",function(f,o){i.once("_promiseSlowoff",function(r){r?o(r):f([t])})})}a.exports={action:function(t,i){return t=c.channel(t),i="ACTION ".concat(i,""),this._sendMessage(this._getPromiseDelay(),t,i,function(f,o){f([t,i])})},ban:function(t,i,f){var o=this;return t=c.channel(t),i=c.username(i),f=c.get(f,""),this._sendCommand(null,t,"/ban ".concat(i," ").concat(f),function(r,n){o.once("_promiseBan",function(m){m?n(m):r([t,i,f])})})},clear:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/clear",function(f,o){i.once("_promiseClear",function(r){r?o(r):f([t])})})},color:function(t,i){var f=this;return i=c.get(i,t),this._sendCommand(null,"#tmijs","/color ".concat(i),function(o,r){f.once("_promiseColor",function(n){n?r(n):o([i])})})},commercial:function(t,i){var f=this;return t=c.channel(t),i=c.get(i,30),this._sendCommand(null,t,"/commercial ".concat(i),function(o,r){f.once("_promiseCommercial",function(n){n?r(n):o([t,~~i])})})},deletemessage:function(t,i){var f=this;return t=c.channel(t),this._sendCommand(null,t,"/delete ".concat(i),function(o,r){f.once("_promiseDeletemessage",function(n){n?r(n):o([t])})})},emoteonly:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/emoteonly",function(f,o){i.once("_promiseEmoteonly",function(r){r?o(r):f([t])})})},emoteonlyoff:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/emoteonlyoff",function(f,o){i.once("_promiseEmoteonlyoff",function(r){r?o(r):f([t])})})},followersonly:k,followersmode:k,followersonlyoff:C,followersmodeoff:C,host:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(2e3,t,"/host ".concat(i),function(o,r){f.once("_promiseHost",function(n,m){n?r(n):o([t,i,~~m])})})},join:function(t){var i=this;return t=c.channel(t),this._sendCommand(void 0,null,"JOIN ".concat(t),function(f,o){var r="_promiseJoin",n=!1,m=function T(y,E){t===c.channel(E)&&(i.removeListener(r,T),n=!0,y?o(y):f([t]))};i.on(r,m),m=i._getPromiseDelay(),c.promiseDelay(m).then(function(){n||i.emit(r,"No response from Twitch.",t)})})},mod:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(null,t,"/mod ".concat(i),function(o,r){f.once("_promiseMod",function(n){n?r(n):o([t,i])})})},mods:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/mods",function(f,o){i.once("_promiseMods",function(r,n){r?o(r):(n.forEach(function(m){i.moderators[t]||(i.moderators[t]=[]),i.moderators[t].includes(m)||i.moderators[t].push(m)}),f(n))})})},part:v,leave:v,ping:function(){var t=this;return this._sendCommand(null,null,"PING",function(i,f){t.latency=new Date,t.pingTimeout=setTimeout(function(){t.ws!==null&&(t.wasCloseCalled=!1,t.log.error("Ping timeout."),t.ws.close(),clearInterval(t.pingLoop),clearTimeout(t.pingTimeout))},c.get(t.opts.connection.timeout,9999)),t.once("_promisePing",function(o){return i([parseFloat(o)])})})},r9kbeta:_,r9kmode:_,r9kbetaoff:s,r9kmodeoff:s,raw:function(t){return this._sendCommand(null,null,t,function(i,f){i([t])})},say:function(t,i){return t=c.channel(t),i.startsWith(".")&&!i.startsWith("..")||i.startsWith("/")||i.startsWith("\\")?i.substr(1,3)==="me "?this.action(t,i.substr(4)):this._sendCommand(null,t,i,function(f,o){f([t,i])}):this._sendMessage(this._getPromiseDelay(),t,i,function(f,o){f([t,i])})},slow:l,slowmode:l,slowoff:p,slowmodeoff:p,subscribers:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/subscribers",function(f,o){i.once("_promiseSubscribers",function(r){r?o(r):f([t])})})},subscribersoff:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/subscribersoff",function(f,o){i.once("_promiseSubscribersoff",function(r){r?o(r):f([t])})})},timeout:function(t,i,f,o){var r=this;return t=c.channel(t),i=c.username(i),f===null||c.isInteger(f)||(o=f,f=300),f=c.get(f,300),o=c.get(o,""),this._sendCommand(null,t,"/timeout ".concat(i," ").concat(f," ").concat(o),function(n,m){r.once("_promiseTimeout",function(T){T?m(T):n([t,i,~~f,o])})})},unban:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(null,t,"/unban ".concat(i),function(o,r){f.once("_promiseUnban",function(n){n?r(n):o([t,i])})})},unhost:function(t){var i=this;return t=c.channel(t),this._sendCommand(2e3,t,"/unhost",function(f,o){i.once("_promiseUnhost",function(r){r?o(r):f([t])})})},unmod:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(null,t,"/unmod ".concat(i),function(o,r){f.once("_promiseUnmod",function(n){n?r(n):o([t,i])})})},unvip:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(null,t,"/unvip ".concat(i),function(o,r){f.once("_promiseUnvip",function(n){n?r(n):o([t,i])})})},vip:function(t,i){var f=this;return t=c.channel(t),i=c.username(i),this._sendCommand(null,t,"/vip ".concat(i),function(o,r){f.once("_promiseVip",function(n){n?r(n):o([t,i])})})},vips:function(t){var i=this;return t=c.channel(t),this._sendCommand(null,t,"/vips",function(f,o){i.once("_promiseVips",function(r,n){r?o(r):f(n)})})},whisper:function(t,i){var f=this;return(t=c.username(t))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs","/w ".concat(t," ").concat(i),function(o,r){f.once("_promiseWhisper",function(n){n&&r(n)})}).catch(function(n){if(n&&typeof n=="string"&&n.indexOf("No response from Twitch.")!==0)throw n;var r=c.channel(t),n=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:f.getUsername()},f.globaluserstate);return f.emits(["whisper","message"],[[r,n,i,!0],[r,n,i,!0]]),[t,i]})}}},{"./utils":9}],5:[function(S,a,w){function c(s){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l})(s)}function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function C(s){return typeof s=="function"}function v(s){return c(s)==="object"&&s!==null}function _(s){return s===void 0}((a.exports=k).EventEmitter=k).prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||isNaN(s))throw TypeError("n must be a positive number");return this._maxListeners=s,this},k.prototype.emit=function(s){var l,p,t,i,f,o;if(this._events||(this._events={}),s==="error"&&(!this._events.error||v(this._events.error)&&!this._events.error.length))throw(l=arguments[1])instanceof Error?l:TypeError('Uncaught, unspecified "error" event.');if(_(p=this._events[s]))return!1;if(C(p))switch(arguments.length){case 1:p.call(this);break;case 2:p.call(this,arguments[1]);break;case 3:p.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),p.apply(this,i)}else if(v(p))for(i=Array.prototype.slice.call(arguments,1),t=(o=p.slice()).length,f=0;f<t;f++)o[f].apply(this,i);return!0},k.prototype.on=k.prototype.addListener=function(s,l){var p;if(!C(l))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,C(l.listener)?l.listener:l),this._events[s]?v(this._events[s])?this._events[s].push(l):this._events[s]=[this._events[s],l]:this._events[s]=l,v(this._events[s])&&!this._events[s].warned&&(p=_(this._maxListeners)?k.defaultMaxListeners:this._maxListeners)&&0<p&&this._events[s].length>p&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),typeof console.trace=="function"&&console.trace()),this},k.prototype.once=function(s,l){if(!C(l))throw TypeError("listener must be a function");var p=!1;if(this._events.hasOwnProperty(s)&&s.charAt(0)==="_"){var t,i=1,f=s;for(t in this._events)this._events.hasOwnProperty(t)&&t.startsWith(f)&&i++;s+=i}function o(){s.charAt(0)!=="_"||isNaN(s.substr(s.length-1))||(s=s.substring(0,s.length-1)),this.removeListener(s,o),p||(p=!0,l.apply(this,arguments))}return o.listener=l,this.on(s,o),this},k.prototype.removeListener=function(s,l){var p,t,i,f;if(!C(l))throw TypeError("listener must be a function");if(!this._events||!this._events[s])return this;if(i=(p=this._events[s]).length,t=-1,p===l||C(p.listener)&&p.listener===l){if(delete this._events[s],this._events.hasOwnProperty(s+"2")&&s.charAt(0)==="_"){var o,r=s;for(o in this._events)this._events.hasOwnProperty(o)&&o.startsWith(r)&&(isNaN(parseInt(o.substr(o.length-1)))||(this._events[s+parseInt(o.substr(o.length-1)-1)]=this._events[o],delete this._events[o]));this._events[s]=this._events[s+"1"],delete this._events[s+"1"]}this._events.removeListener&&this.emit("removeListener",s,l)}else if(v(p)){for(f=i;0<f--;)if(p[f]===l||p[f].listener&&p[f].listener===l){t=f;break}if(t<0)return this;p.length===1?(p.length=0,delete this._events[s]):p.splice(t,1),this._events.removeListener&&this.emit("removeListener",s,l)}return this},k.prototype.removeAllListeners=function(s){var l,p;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[s]&&delete this._events[s],this;if(arguments.length===0){for(l in this._events)l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events={},this}if(C(p=this._events[s]))this.removeListener(s,p);else if(p)for(;p.length;)this.removeListener(s,p[p.length-1]);return delete this._events[s],this},k.prototype.listeners=function(s){return s=this._events&&this._events[s]?C(this._events[s])?[this._events[s]]:this._events[s].slice():[],s},k.prototype.listenerCount=function(s){if(this._events){if(s=this._events[s],C(s))return 1;if(s)return s.length}return 0},k.listenerCount=function(s,l){return s.listenerCount(l)}},{}],6:[function(S,a,w){var c=S("./utils"),k="info",C={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function v(_){return function(s){C[k]<=C[_]&&console.log("[".concat(c.formatDate(new Date),"] ").concat(_,": ").concat(s))}}a.exports={setLevel:function(_){k=_},trace:v("trace"),debug:v("debug"),info:v("info"),warn:v("warn"),error:v("error"),fatal:v("fatal")}},{"./utils":9}],7:[function(S,a,w){var c=S("./utils"),k=/\S+/g;function C(v,_,t,o,p){var t=2<arguments.length&&t!==void 0?t:",",i=3<arguments.length&&o!==void 0?o:"/",f=4<arguments.length?p:void 0,o=v[_];if(o===void 0)return v;if(p=typeof o=="string",v[_+"-raw"]=p?o:null,o===!0)return v[_]=null,v;if(v[_]={},p)for(var r=o.split(t),n=0;n<r.length;n++){var m=r[n].split(i),T=m[1];f!==void 0&&T&&(T=T.split(f)),v[_][m[0]]=T||null}return v}a.exports={badges:function(v){return C(v,"badges")},badgeInfo:function(v){return C(v,"badge-info")},emotes:function(v){return C(v,"emotes","/",":",",")},emoteRegex:function(v,_,s,l){k.lastIndex=0;for(var p,t=new RegExp("(\\b|^|\\s)"+c.unescapeHtml(_)+"(\\b|$|\\s)");(p=k.exec(v))!==null;)t.test(p[0])&&(l[s]=l[s]||[],l[s].push([p.index,k.lastIndex-1]))},emoteString:function(v,_,s,l){var p;for(k.lastIndex=0;(p=k.exec(v))!==null;)p[0]===c.unescapeHtml(_)&&(l[s]=l[s]||[],l[s].push([p.index,k.lastIndex-1]))},transformEmotes:function(v){var _="";return Object.keys(v).forEach(function(s){_="".concat(_+s,":"),v[s].forEach(function(l){return _="".concat(_+l.join("-"),",")}),_="".concat(_.slice(0,-1),"/")}),_.slice(0,-1)},formTags:function(v){var _,s=[];for(_ in v){var l=c.escapeIRC(v[_]);s.push("".concat(_,"=").concat(l))}return"@".concat(s.join(";"))},msg:function(v){var _={raw:v,tags:{},prefix:null,command:null,params:[]},s=0,l=0;if(v.charCodeAt(0)===64){if((l=v.indexOf(" "))===-1)return null;for(var p=v.slice(1,l).split(";"),t=0;t<p.length;t++){var i=p[t],f=i.split("=");_.tags[f[0]]=i.substring(i.indexOf("=")+1)||!0}s=l+1}for(;v.charCodeAt(s)===32;)s++;if(v.charCodeAt(s)===58){if((l=v.indexOf(" ",s))===-1)return null;for(_.prefix=v.slice(s+1,l),s=l+1;v.charCodeAt(s)===32;)s++}if((l=v.indexOf(" ",s))===-1)return v.length>s?(_.command=v.slice(s),_):null;for(_.command=v.slice(s,l),s=l+1;v.charCodeAt(s)===32;)s++;for(;s<v.length;){if(l=v.indexOf(" ",s),v.charCodeAt(s)===58){_.params.push(v.slice(s+1));break}if(l===-1){if(l===-1){_.params.push(v.slice(s));break}}else for(_.params.push(v.slice(s,l)),s=l+1;v.charCodeAt(s)===32;)s++}return _}}},{"./utils":9}],8:[function(S,a,w){function c(k,C){for(var v=0;v<C.length;v++){var _=C[v];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(k,_.key,_)}}a.exports=function(){function k(_){(function(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")})(this,k),this.queue=[],this.index=0,this.defaultDelay=_===void 0?3e3:_}var C,v;return C=k,(v=[{key:"add",value:function(_,s){this.queue.push({fn:_,delay:s})}},{key:"next",value:function(){var _,s=this,l=this.index++,l=this.queue[l];l&&(_=this.queue[this.index],l.fn(),_&&(l=_.delay===void 0?this.defaultDelay:_.delay,setTimeout(function(){return s.next()},l)))}}])&&c(C.prototype,v),k}()},{}],9:[function(S,a,w){(function(c){(function(){function k(n){return(k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(n)}var C,v=/^\u0001ACTION ([^\u0001]+)\u0001$/,_=/^(justinfan)(\d+$)/,s=/\\([sn:r\\])/g,l=/([ \n;\r\\])/g,p={s:" ",n:"",":":";",r:""},t={" ":"s","\n":"n",";":":","\r":"r"},i=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),f=/[|\\^$*+?:#]/,o=a.exports={get:function(n,m){return n===void 0?m:n},hasOwn:function(n,m){return{}.hasOwnProperty.call(n,m)},promiseDelay:function(n){return new Promise(function(m){return setTimeout(m,n)})},isFinite:(C=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},r.toString=function(){return C.toString()},r),toNumber:function(n,m){return n===null?0:(m=Math.pow(10,o.isFinite(m)?m:0),Math.round(n*m)/m)},isInteger:function(n){return!isNaN(o.toNumber(n,0))},isRegex:function(n){return f.test(n)},isURL:function(n){return i.test(n)},justinfan:function(){return"justinfan".concat(Math.floor(8e4*Math.random()+1e3))},isJustinfan:function(n){return _.test(n)},channel:function(n){var m;return(m=(n||"").toLowerCase())[0]==="#"?m:"#"+m},username:function(n){var m;return(m=(n||"").toLowerCase())[0]==="#"?m.slice(1):m},token:function(n){return n?n.toLowerCase().replace("oauth:",""):""},password:function(n){return n=o.token(n),n?"oauth:".concat(n):""},actionMessage:function(n){return n.match(v)},replaceAll:function(n,m){if(n==null)return null;for(var T in m)n=n.replace(new RegExp(T,"g"),m[T]);return n},unescapeHtml:function(n){return n.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(n){return n&&typeof n=="string"&&n.includes("\\")?n.replace(s,function(m,T){return T in p?p[T]:T}):n},escapeIRC:function(n){return n&&typeof n=="string"?n.replace(l,function(m,T){return T in t?"\\".concat(t[T]):T}):n},addWord:function(n,m){return n.length?n+" "+m:n+m},splitLine:function(n,m){var T=n.substring(0,m).lastIndexOf(" ");return[n.substring(0,T=T===-1?m-1:T),n.substring(T+1)]},extractNumber:function(n){for(var m=n.split(" "),T=0;T<m.length;T++)if(o.isInteger(m[T]))return~~m[T];return 0},formatDate:function(T){var m=T.getHours(),T=((T=T.getMinutes())<10?"0":"")+T;return"".concat(m=(m<10?"0":"")+m,":").concat(T)},inherits:function(n,m){n.super_=m;function T(){}T.prototype=m.prototype,n.prototype=new T,n.prototype.constructor=n},isNode:function(){try{return(c===void 0?"undefined":k(c))==="object"&&Object.prototype.toString.call(c)==="[object process]"}catch{}return!1}};function r(n){return C.apply(this,arguments)}}).call(this)}).call(this,S("_process"))},{_process:11}],10:[function(S,a,w){},{}],11:[function(S,C,w){var c,k,C=C.exports={};function v(){throw new Error("setTimeout has not been defined")}function _(){throw new Error("clearTimeout has not been defined")}function s(m){if(c===setTimeout)return setTimeout(m,0);if((c===v||!c)&&setTimeout)return c=setTimeout,setTimeout(m,0);try{return c(m,0)}catch{try{return c.call(null,m,0)}catch{return c.call(this,m,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:v}catch{c=v}try{k=typeof clearTimeout=="function"?clearTimeout:_}catch{k=_}})();var l,p=[],t=!1,i=-1;function f(){t&&l&&(t=!1,l.length?p=l.concat(p):i=-1,p.length&&o())}function o(){if(!t){var m=s(f);t=!0;for(var T=p.length;T;){for(l=p,p=[];++i<T;)l&&l[i].run();i=-1,T=p.length}l=null,t=!1,function(y){if(k===clearTimeout)return clearTimeout(y);if((k===_||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(y);try{k(y)}catch{try{return k.call(null,y)}catch{return k.call(this,y)}}}(m)}}function r(m,T){this.fun=m,this.array=T}function n(){}C.nextTick=function(m){var T=new Array(arguments.length-1);if(1<arguments.length)for(var y=1;y<arguments.length;y++)T[y-1]=arguments[y];p.push(new r(m,T)),p.length!==1||t||s(o)},r.prototype.run=function(){this.fun.apply(null,this.array)},C.title="browser",C.browser=!0,C.env={},C.argv=[],C.version="",C.versions={},C.on=n,C.addListener=n,C.once=n,C.off=n,C.removeListener=n,C.removeAllListeners=n,C.emit=n,C.prependListener=n,C.prependOnceListener=n,C.listeners=function(m){return[]},C.binding=function(m){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(m){throw new Error("process.chdir is not supported")},C.umask=function(){return 0}},{}]},{},[1]);var ve={exports:{}};(function(S,a){var w=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof he<"u")return he;throw new Error("unable to locate global object")},c=w();S.exports=a=c.fetch,c.fetch&&(a.default=c.fetch.bind(c)),a.Headers=c.Headers,a.Request=c.Request,a.Response=c.Response})(ve,ve.exports);var He=ve.exports,Je=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};(function(S){var a=Ge,w=He,c=Je,k={global:{},users:{}},C=function(r,n){if(!r)return{any:null,user:null};var m=new Date,T={};return k.global[r]?T.any=m-k.global[r]:T.any=0,k.global[r]=m,n?(k.users[n]||(k.users[n]={}),k.users[n][r]?T.user=m-k.users[n][r]:T.user=0,k.users[n][r]=m):T.user=null,T};function v(r){for(var n="",m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",T=0;T<r;T++)n+=m.charAt(Math.floor(Math.random()*m.length));return n}async function _(r,n){let y;n=n.replace("oauth:","");let E=await w("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${n}`}}).then(d=>d.json());if(!E.client_id||!E.scopes.includes("channel:read:redemptions")||!E.scopes.includes("user:read:email")){console.error("Invalid Password or Permission Scopes (channel:read:redemptions, user:read:email)");return}let u=(await w("https://api.twitch.tv/helix/users?login="+r,{headers:{"Client-ID":E.client_id,Authorization:`Bearer ${n}`}}).then(d=>d.json())).data[0].id,h;typeof window<"u"?h=new WebSocket("wss://pubsub-edge.twitch.tv"):h=new c,h.onopen=function(d){h.send(JSON.stringify({type:"PING"})),y=setInterval(()=>{h.send(JSON.stringify({type:"PING"}))},6e4);let g={type:"LISTEN",nonce:v(15),data:{topics:[`channel-points-channel-v1.${u}`],auth_token:n}};h.send(JSON.stringify(g))},h.onerror=function(d){console.error(d)},h.onmessage=function(d){switch(message=JSON.parse(d.data),message.type){case"RESPONSE":message.error==="ERR_BADAUTH"&&console.error("PubSub Authentication Failure");break;case"RECONNECT":setTimeout(()=>{_(r,n)},3e3);break;case"MESSAGE":if(message.data.topic.startsWith("channel-points-channel")){let R=JSON.parse(message.data.message);if(R.type==="reward-redeemed"){let L=R.data.redemption;var g=L.reward,D={id:g.id,channelId:g.channel_id,title:g.title,prompt:g.prompt,cost:g.cost,userInputRequired:g.is_user_input_required,subOnly:g.is_sub_only,image:{url1x:g.image?g.image.url_1x:null,url2x:g.image?g.image.url_2x:null,url4x:g.image?g.image.url_4x:null},defaultImage:{url1x:g.default_image.url_1x,url2x:g.default_image.url_2x,url4x:g.default_image.url_4x},backgroundColor:g.background_color,enabled:g.is_enabled,paused:g.is_paused,inStock:g.is_in_stock,maxPerStream:{enabled:g.max_per_stream.is_enabled,maxPerStream:g.max_per_stream.max_per_stream},shouldRedemptionsSkipRequestQueue:g.should_redemptions_skip_request_queue,templateId:g.template_id,updatedForIndicatorAt:g.updated_for_indicator_at,maxPerUserPerStream:{enabled:g.max_per_user_per_stream.is_enabled,maxPerUserPerStream:g.max_per_user_per_stream.max_per_user_per_stream},globalCooldown:{enabled:g.global_cooldown.is_enabled,globalCooldownSeconds:g.global_cooldown.global_cooldown_seconds},redemptionsRedeemedCurrentStream:g.redemptions_redeemed_current_stream,cooldownExpiresAt:g.cooldown_expires_at},A={channelId:L.channel_id,reward:D,rewardFulfilled:L.status==="FULFILLED",userId:L.user.id,username:L.user.login,displayName:L.user.display_name,customRewardId:L.id,timestamp:L.redeemed_at};o.onReward(L.user.display_name||L.user.login,L.reward.title,L.reward.cost,L.user_input||"",A)}}break}},h.onclose=function(){clearInterval(y),setTimeout(()=>{_(r,n)},3e3)}}var s="",l="",p=null,t=null,i=!0,f=0,o={isDebug:!1,chatModes:{},version:function(){return"@VERSION"},onError:function(r){console.error("Error:",r)},onCommand:function(r,n,m,T,y){o.isDebug&&console.log("onCommand default handler")},onChat:function(r,n,m,T,y){o.isDebug&&console.log("onChat default handler")},onWhisper:function(r,n,m,T,y){o.isDebug&&console.log("onWhisper default handler")},onMessageDeleted:function(r,n){o.isDebug&&console.log("onMessageDeleted default handler")},onBan:function(r,n){o.isDebug&&console.log("onBan default handler")},onTimeout:function(r,n,m){o.isDebug&&console.log("onTimeout default handler")},onJoin:function(r,n,m){o.isDebug&&console.log("onJoin default handler")},onPart:function(r,n,m){o.isDebug&&console.log("onPart default handler")},onHosted:function(r,n,m,T){o.isDebug&&console.log("onHosted default handler")},onRaid:function(r,n,m){o.isDebug&&console.log("onRaid default handler")},onSub:function(r,n,m,T){o.isDebug&&console.log("onSub default handler")},onResub:function(r,n,m,T,y,E){o.isDebug&&console.log("onResub default handler")},onSubGift:function(r,n,m,T,y,E){o.isDebug&&console.log("onSubGift default handler")},onSubMysteryGift:function(r,n,m,T,y){o.isDebug&&console.log("onSubMysteryGift default handler")},onGiftSubContinue:function(r,n,m){o.isDebug&&console.log("onGiftSubContinue default handler")},onCheer:function(r,n,m,T,y){o.isDebug&&console.log("onCheer default handler")},onChatMode:function(r,n){o.isDebug&&console.log("onChatMode default handler")},onReward:function(r,n,m,T,y){o.isDebug&&console.log("onReward default handler")},onConnected:function(r,n,m){},onReconnect:function(r){},Say:function(r,n){return t?(n||(n=s),t.say(n,r).catch(o.onError),!0):!1},Whisper:function(r,n){return t?(t.whisper(n,r).catch(o.onError),!0):!1},Announce:function(r,n,m=null){return t?(n||(n=s),t.say(n,`/announce ${r}`).catch(o.onError),!0):!1},DeleteMessage:function(r,n){return t?(n||(n=s),t.deletemessage(n,r).catch(o.onError),!0):!1},GetClient:function(){return t},Init:function(r,n,m,T){if(m=m||[r],(typeof m=="string"||m instanceof String)&&(m=[m]),!Array.isArray(m))throw new Error("Channels is not an array");o.isDebug=T,s=m[0];var y={options:{debug:T,skipUpdatingEmotesets:!0},connection:{reconnect:!0,secure:!0},channels:m};n&&(y.identity={username:r,password:n},l=n),t=new a.client(y),t.on("roomstate",function(E,e){try{var u=E.replace("#","");o.chatModes[u]=o.chatModes[u]||{},"emote-only"in e&&(o.chatModes[u].emoteOnly=e["emote-only"]),"followers-only"in e&&(o.chatModes[u].followerOnly=e["followers-only"]>=0),"subs-only"in e&&(o.chatModes[u].subOnly=e["subs-only"]),"r9k"in e&&(o.chatModes[u].r9kMode=e.r9k),"slow"in e&&(o.chatModes[u].slowMode=e.slow),o.onChatMode(o.chatModes[u],u)}catch(h){o.onError(h)}}),t.on("message",function(E,e,u,h){try{var d=e["display-name"]||e.username||r,g="#"+e.username===E,D=e.mod,A=e.badges&&e.badges.founder==="0",R=A||e.badges&&typeof e.badges.subscriber<"u"||e.subscriber,L=e.badges&&e.badges.vip==="1"||!1,j=e["msg-id"]==="highlighted-message",U=e["user-id"],b=e.id,x=e["room-id"],M=e.badges,I=e.color,ke=e.emotes,pe=e.flags,ge=e["tmi-sent-ts"],ue=e["emote-only"]||!1,G=e["message-type"],F=e["custom-reward-id"]||null,K={broadcaster:g,mod:D,founder:A,subscriber:R||A,vip:L,highlighted:j,customReward:!!F},V={id:b,channel:E.replace("#",""),roomId:x,messageType:G,messageEmotes:ke,isEmoteOnly:ue,userId:U,username:e.username,displayName:e["display-name"],userColor:I,userBadges:M,userState:e,customRewardId:F,flags:pe,timestamp:ge};if(!h&&u[0]==="!"){var $=u.split(/ (.*)/),P=$[0].slice(1).toLowerCase(),O=$[1]||"";V.sinceLastCommand=C(P,U),o.onCommand(d,P,O,K,V)}else G==="action"||G==="chat"?o.onChat(d,u,K,h,V):G==="whisper"&&o.onWhisper(d,u,K,h,V)}catch(te){o.onError(te)}}),t.on("messagedeleted",function(E,e,u,h){try{var d=h["target-msg-id"],g=h["room-id"],D={id:d,roomId:g,username:e,message:u};o.onMessageDeleted(d,D)}catch(A){o.onError(A)}}),t.on("ban",function(E,e,u,h){try{var d=e,g=h["room-id"],D=h["target-user-id"],A={roomId:g,username:e,bannedUserId:D};o.onBan(d,A)}catch(R){o.onError(R)}}),t.on("timeout",function(E,e,u,h,d){try{var g=e,D=h,A=d["room-id"],R=d["target-user-id"],L={roomId:A,username:e,timedOutUserId:R};o.onTimeout(g,D,L)}catch(j){o.onError(j)}}),t.on("join",function(E,e,u){var h={channel:E.replace("#","")};o.onJoin(e,u,h)}),t.on("part",function(E,e,u){var h={channel:E.replace("#","")};o.onPart(e,u,h)}),t.on("hosted",function(E,e,u,h){var d={channel:E.replace("#","")};o.onHosted(e,u,h,d)}),t.on("raided",function(E,e,u){var h={channel:E.replace("#","")};o.onRaid(e,u,h)}),t.on("cheer",function(E,e,u){var h=~~e.bits,d=e["room-id"],g=e["display-name"]||e.username||e.login,D=e["user-id"],A="#"+e.username===E,R=e.mod,L=e.badges&&e.badges.founder==="0",j=L||e.badges&&typeof e.badges.subscriber<"u"||e.subscriber,U=e.badges&&e.badges.vip==="1"||!1,b={broadcaster:A,mod:R,founder:L,subscriber:j,vip:U},x={id:e.id,channel:E.replace("#",""),roomId:d,userId:D,username:e.username,userColor:e.color,userBadges:e.badges,userState:e,displayName:e["display-name"],messageEmotes:e.emotes,subscriber:e.subscriber};o.onCheer(g,u,h,b,x)}),t.on("subscription",function(E,e,u,h,d){var g={id:d.id,roomId:d["room-id"],messageType:d["message-type"],messageEmotes:d.emotes,userId:d["user-id"],username:d.login,displayName:d["display-name"],userColor:d.color,userBadges:d.badges,userState:d,channel:E.replace("#","")};o.onSub(e,h,u,g)}),t.on("resub",function(E,e,u,h,d,g){var D=~~d["msg-param-cumulative-months"],A={id:d.id,roomId:d["room-id"],messageType:d["message-type"],messageEmotes:d.emotes,userId:d["user-id"],username:d.login,displayName:d["display-name"],userColor:d.color,userBadges:d.badges,channel:E.replace("#","")};o.onResub(e,h,u,D,g,A)}),t.on("subgift",function(E,e,u,h,d,g){var D=~~g["msg-param-sender-count"],A={id:g.id,roomId:g["room-id"],messageType:g["message-type"],messageEmotes:g.emotes,userId:g["user-id"],username:g.login,displayName:g["display-name"],userColor:g.color,userBadges:g.badges,userState:g,recipientDisplayName:g["msg-param-recipient-display-name"],recipientUsername:g["msg-param-recipient-user-name"],recipientId:g["msg-param-recipient-id"],channel:E.replace("#","")};o.onSubGift(e,u,h,D,d,A)}),t.on("submysterygift",function(E,e,u,h,d){var g=~~d["msg-param-sender-count"],D={id:d.id,roomId:d["room-id"],messageType:d["message-type"],messageEmotes:d.emotes,userId:d["user-id"],username:d.login,displayName:d["display-name"],userColor:d.color,userBadges:d.badges,userState:d,recipientDisplayName:d["msg-param-recipient-display-name"],recipientUsername:d["msg-param-recipient-user-name"],recipientId:d["msg-param-recipient-id"],userMassGiftCount:~~d["msg-param-mass-gift-count"],channel:E.replace("#","")};o.onSubMysteryGift(e,u,g,h,D)}),t.on("giftpaidupgrade",function(E,e,u,h){var d={id:h.id,roomId:h["room-id"],messageType:h["message-type"],messageEmotes:h.emotes,userId:h["user-id"],username:h.login,displayName:h["display-name"],userColor:h.color,userBadges:h.badges,userState:h,gifterUsername:h["msg-param-sender-login"],gifterDisplayName:h["msg-param-sender-name"],channel:E.replace("#","")};o.onGiftSubContinue(e,u,d)}),t.on("connected",function(E,e){console.log("Connected:"+E+":"+e),o.onConnected(E,e,i),i=!1}),t.on("reconnect",function(){console.log("Reconnecting"),f++,o.onReconnect(f)}),t.connect().catch(o.onError),n&&_(s,n)},Disconnect:function(){t.disconnect().catch(o.onError)},GetChannelRewards:async function(r,n=!1){return l?(p||(p=(await w(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(y=>y.json())).data[0]),(await w(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${p.id}&only_manageable_rewards=${n}`,{headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(T=>T.json())).data||[]):[]},CreateChannelReward:async function(r,n){if(l)return p||(p=(await w(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(y=>y.json())).data[0]),(await w(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${p.id}`,{method:"POST",headers:{"Client-ID":r,Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(T=>T.json())).data[0];throw new Error("Missing Channel Password")},UpdateChannelReward:async function(r,n,m){if(l)return p||(p=(await w(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(E=>E.json())).data[0]),(await w(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${p.id}&id=${n}`,{method:"PATCH",headers:{"Client-ID":r,Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(m)}).then(y=>y.json())).data[0];throw new Error("Missing Channel Password")},DeleteChannelReward:async function(r,n){if(l)return p||(p=(await w(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(y=>y.json())).data[0]),await w(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${p.id}&id=${n}`,{method:"DELETE",headers:{"Client-ID":r,Authorization:`Bearer ${l}`}}).then(T=>T.text());throw new Error("Missing Channel Password")}};S.exports&&(S.exports=o),typeof window<"u"&&(window.ComfyJS=o,a=window.tmi)})(Ie);var qe=Ie.exports;const ye=$e(qe),re=configs,N=configs.user,{languageCode:J,maxTasksPerUser:Fe}=configs.settings,{twitch_channel:Be,twitch_oauth:We,twitch_username:ze}=configs.auth;function Ve(){ye.Init(ze,We,[Be]),ye.onCommand=(S,a,w,c,k)=>{a=`!${a.toLowerCase()}`;try{if(Ke(c)){if(re.commands.adminClearList.includes(a))return userList.clearUserList(),q(re.responseTo[J].adminClearList,S),le();if(re.commands.adminClearDoneTasks.includes(a))return userList.clearDoneTasks(),q(re.responseTo[J].adminClearDoneTasks,S),le();if(re.commands.adminClearUser.includes(a))return userList.deleteUser(w),q(re.responseTo[J].adminClearUser,S,w),le()}if(N.commands.addTask.includes(a)){if(w==="")throw new Error("Task description is empty");let C=userList.getUser(S);C||(C=userList.createUser(S,{nameColor:k.color}));const v=w.split(", ");C.getTasks.length+v.length>Fe?q(N.responseTo[J].maxTasksAdded,S):(userList.addUserTasks(S,v),q(N.responseTo[J].addTask,S,w))}else if(N.commands.editTask.includes(a)){const C=w.search(new RegExp("(?<=\\d)\\s")),v=w.slice(C+1),_=we(w.slice(0,C));userList.editUserTask(S,_,v),q(N.responseTo[J].editTask,S,v)}else if(N.commands.finishTask.includes(a)){const C=we(w),v=userList.completeUserTasks(S,C);q(N.responseTo[J].finishTask,S,v)}else if(N.commands.deleteTask.includes(a)){const C=we(w),v=userList.deleteUserTasks(S,C);q(N.responseTo[J].deleteTask,S,v)}else if(N.commands.check.includes(a)){const C=userList.checkUserTasks(S).join(", ");q(N.responseTo[J].check,S,C)}else if(N.commands.help.includes(a))q(N.responseTo[J].help);else if(N.commands.additional.includes(a))q(N.responseTo[J].additional);else throw new Error("Invalid command");return le()}catch(C){console.error(C.message,`
data: username: ${S} - command: ${a} - message: ${w}`)}}}function q(S,a="",w=""){ye.Say(S.replace("{user}",a).replace("{message}",w))}function Ke(S){return S.broadcaster||S.mod}function we(S){return parseInt(S,10)-1}window.addEventListener("load",()=>{window.userList=new ee,Re(),Ve(),configs.settings.testMode&&(window.userList.users=Ue()),le(window.userList.users)})})();
