var Ke=($,q,K)=>{if(!q.has($))throw TypeError("Cannot "+K)};var ye=($,q,K)=>{if(q.has($))throw TypeError("Cannot add the same private member more than once");q instanceof WeakSet?q.add($):q.set($,K)};var V=($,q,K)=>(Ke($,q,"access private method"),K);(function(){"use strict";var le,Oe,F,Q;var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var K={exports:{}};function ce(S){throw new Error('Could not dynamically require "'+S+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Le={};(function S(c,y,l){function k(p,s){if(!y[p]){if(!c[p]){var a=typeof ce=="function"&&ce;if(!s&&a)return a(p,!0);if(T)return T(p,!0);throw(a=new Error("Cannot find module '"+p+"'")).code="MODULE_NOT_FOUND",a}a=y[p]={exports:{}},c[p][0].call(a.exports,function(h){return k(c[p][1][h]||h)},a,a.exports,S,c,y,l)}return y[p].exports}for(var T=typeof ce=="function"&&ce,_=0;_<l.length;_++)k(l[_]);return k})({1:[function(S,c,y){S=S("./lib/client"),c.exports={client:S,Client:S}},{"./lib/client":3}],2:[function(S,c,y){function l(p,s){var a,h=Object.keys(p);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(p),s&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(p,t).enumerable})),h.push.apply(h,a)),h}function k(p){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?l(Object(a),!0).forEach(function(h){var t,o;t=p,h=a[o=h],o in t?Object.defineProperty(t,o,{value:h,enumerable:!0,configurable:!0,writable:!0}):t[o]=h}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(h){Object.defineProperty(p,h,Object.getOwnPropertyDescriptor(a,h))})}return p}var T=S("node-fetch"),_=S("./utils");c.exports=function(p,s){var a=p.url!==void 0?p.url:p.uri;if(_.isURL(a)||(a="https://api.twitch.tv/kraken".concat(a[0]==="/"?a:"/".concat(a))),_.isNode()){var h=Object.assign({method:"GET",json:!0},p);h.qs&&(t=new URLSearchParams(h.qs),a+="?".concat(t));var t={};"fetchAgent"in this.opts.connection&&(t.agent=this.opts.connection.fetchAgent);var t=T(a,k(k({},t),{},{method:h.method,headers:h.headers,body:h.body})),o={};t.then(function(n){return o={statusCode:n.status,headers:n.headers},h.json?n.json():n.text()}).then(function(n){return s(null,o,n)},function(n){return s(n,o,null)})}else{var f,i=Object.assign({method:"GET",headers:{}},p,{url:a}),r=new XMLHttpRequest;for(f in r.open(i.method,i.url,!0),i.headers)r.setRequestHeader(f,i.headers[f]);r.responseType="json",r.addEventListener("load",function(n){r.readyState===4&&(r.status!==200?s(r.status,null,null):s(null,null,r.response))}),r.send()}}},{"./utils":9,"node-fetch":10}],3:[function(S,c,y){(function(l){(function(){function k(e,u){var d,g=Object.keys(e);return Object.getOwnPropertySymbols&&(d=Object.getOwnPropertySymbols(e),u&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(e,b).enumerable})),g.push.apply(g,d)),g}function T(e){for(var u=1;u<arguments.length;u++){var d=arguments[u]!=null?arguments[u]:{};u%2?k(Object(d),!0).forEach(function(g){var b,D;b=e,g=d[D=g],D in b?Object.defineProperty(b,D,{value:g,enumerable:!0,configurable:!0,writable:!0}):b[D]=g}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(d)):k(Object(d)).forEach(function(g){Object.defineProperty(e,g,Object.getOwnPropertyDescriptor(d,g))})}return e}function _(e){return function(u){if(Array.isArray(u))return p(u)}(e)||function(u){if(typeof Symbol<"u"&&u[Symbol.iterator]!=null||u["@@iterator"]!=null)return Array.from(u)}(e)||function(u,d){if(u){if(typeof u=="string")return p(u,d);var g=Object.prototype.toString.call(u).slice(8,-1);return(g=g==="Object"&&u.constructor?u.constructor.name:g)==="Map"||g==="Set"?Array.from(u):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?p(u,d):void 0}}(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function p(e,u){(u==null||u>e.length)&&(u=e.length);for(var d=0,g=new Array(u);d<u;d++)g[d]=e[d];return g}function s(e){if(!(this instanceof s))return new s(e);this.opts=w.get(e,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=w.get(this.opts.options.clientId,null),this._globalDefaultChannel=w.channel(w.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=w.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=w.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=w.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=w.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=w.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=w.get(this.opts.connection.reconnect,!0),this.reconnectDecay=w.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=w.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=w.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null,e="error",this.opts.options.debug&&(e="info"),this.log=this.opts.logger||n;try{n.setLevel(e)}catch{}this.opts.channels.forEach(function(u,d,g){return g[d]=w.channel(u)}),r.call(this),this.setMaxListeners(0)}var a,h=l!==void 0?l:typeof window<"u"?window:{},t=h.WebSocket||S("ws"),o=h.fetch||S("node-fetch"),f=S("./api"),i=S("./commands"),r=S("./events").EventEmitter,n=S("./logger"),m=S("./parser"),C=S("./timer"),w=S("./utils"),E=!1;for(a in w.inherits(s,r),i)s.prototype[a]=i[a];s.prototype.emits=function(e,u){for(var d=0;d<e.length;d++){var g=d<u.length?u[d]:u[u.length-1];this.emit.apply(this,[e[d]].concat(g))}},s.prototype.api=function(){E||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),E=!0),f.apply(void 0,arguments)},s.prototype.handleMessage=function(e){var u=this;if(e){this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);var d,g,b,D,A,R,L,j,N,v=w.channel(w.get(e.params[0],null)),x=w.get(e.params[1],null),P=w.get(e.tags["msg-id"],null),I=e.tags=m.badges(m.badgeInfo(m.emotes(e.tags)));for(d in I)d!=="emote-sets"&&d!=="ban-duration"&&d!=="bits"&&(typeof(g=I[d])=="boolean"?g=null:g==="1"?g=!0:g==="0"?g=!1:typeof g=="string"&&(g=w.unescapeIRC(g)),I[d]=g);if(e.prefix===null)switch(e.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":var _e=new Date;this.currentLatency=(_e.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn(`Could not parse message with no prefix:
`.concat(JSON.stringify(e,null,4)))}else if(e.prefix==="tmi.twitch.tv")switch(e.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=e.params[0];break;case"376":this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(function(){u._isConnected()&&u.ws.send("PING"),u.latency=new Date,u.pingTimeout=setTimeout(function(){u.ws!==null&&(u.wasCloseCalled=!1,u.log.error("Ping timeout."),u.ws.close(),clearInterval(u.pingLoop),clearTimeout(u.pingTimeout),clearTimeout(u._updateEmotesetsTimer))},w.get(u.opts.connection.timeout,9999))},6e4);var se=w.get(this.opts.options.joinInterval,2e3),ue=new C(se=se<300?300:se),me=_(new Set([].concat(_(this.opts.channels),_(this.channels))));this.channels=[];for(var re=0;re<me.length;re++)(function(J){var ze=me[J];ue.add(function(){u._isConnected()&&u.join(ze).catch(function(Ve){return u.log.error(Ve)})})})(re);ue.next();break;case"NOTICE":var G=[null],H=[v,P,x],W=[v,!0],B=[v,!1],U=[H,G],M=[H,[P]],O="[".concat(v,"] ").concat(x);switch(P){case"subs_on":this.log.info("[".concat(v,"] This room is now in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribers"],[W,W,G]);break;case"subs_off":this.log.info("[".concat(v,"] This room is no longer in subscribers-only mode.")),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[B,B,G]);break;case"emote_only_on":this.log.info("[".concat(v,"] This room is now in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonly"],[W,G]);break;case"emote_only_off":this.log.info("[".concat(v,"] This room is no longer in emote-only mode.")),this.emits(["emoteonly","_promiseEmoteonlyoff"],[B,G]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info("[".concat(v,"] This room is now in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[W,W,G]);break;case"r9k_off":this.log.info("[".concat(v,"] This room is no longer in r9k mode.")),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[B,B,G]);break;case"room_mods":var X=x.split(": "),X=(1<X.length?X[1]:"").toLowerCase().split(", ").filter(function(J){return J});this.emits(["_promiseMods","mods"],[[null,X],[v,X]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[v,[]]]);break;case"vips_success":var Z=(x=x.endsWith(".")?x.slice(0,-1):x).split(": "),Z=(1<Z.length?Z[1]:"").toLowerCase().split(", ").filter(function(J){return J});this.emits(["_promiseVips","vips"],[[null,Z],[v,Z]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[v,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(O),this.emits(["notice","_promiseBan"],M);break;case"ban_success":this.log.info(O),this.emits(["notice","_promiseBan"],U);break;case"usage_clear":this.log.info(O),this.emits(["notice","_promiseClear"],M);break;case"usage_mods":this.log.info(O),this.emits(["notice","_promiseMods"],[H,[P,[]]]);break;case"mod_success":this.log.info(O),this.emits(["notice","_promiseMod"],U);break;case"usage_vips":this.log.info(O),this.emits(["notice","_promiseVips"],[H,[P,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(O),this.emits(["notice","_promiseVip"],[H,[P,[]]]);break;case"vip_success":this.log.info(O),this.emits(["notice","_promiseVip"],U);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(O),this.emits(["notice","_promiseMod"],M);break;case"unmod_success":this.log.info(O),this.emits(["notice","_promiseUnmod"],U);break;case"unvip_success":this.log.info(O),this.emits(["notice","_promiseUnvip"],U);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(O),this.emits(["notice","_promiseUnmod"],M);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(O),this.emits(["notice","_promiseUnvip"],M);break;case"color_changed":this.log.info(O),this.emits(["notice","_promiseColor"],U);break;case"usage_color":case"turbo_only_color":this.log.info(O),this.emits(["notice","_promiseColor"],M);break;case"commercial_success":this.log.info(O),this.emits(["notice","_promiseCommercial"],U);break;case"usage_commercial":case"bad_commercial_error":this.log.info(O),this.emits(["notice","_promiseCommercial"],M);break;case"hosts_remaining":this.log.info(O),Z=isNaN(x[0])?0:parseInt(x[0]),this.emits(["notice","_promiseHost"],[H,[null,~~Z]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(O),this.emits(["notice","_promiseHost"],[H,[P,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(O),this.emits(["notice","_promiseR9kbeta"],M);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(O),this.emits(["notice","_promiseR9kbetaoff"],M);break;case"timeout_success":this.log.info(O),this.emits(["notice","_promiseTimeout"],U);break;case"delete_message_success":this.log.info("[".concat(v," ").concat(x,"]")),this.emits(["notice","_promiseDeletemessage"],U);break;case"already_subs_off":case"usage_subs_off":this.log.info(O),this.emits(["notice","_promiseSubscribersoff"],M);break;case"already_subs_on":case"usage_subs_on":this.log.info(O),this.emits(["notice","_promiseSubscribers"],M);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(O),this.emits(["notice","_promiseEmoteonlyoff"],M);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(O),this.emits(["notice","_promiseEmoteonly"],M);break;case"usage_slow_on":this.log.info(O),this.emits(["notice","_promiseSlow"],M);break;case"usage_slow_off":this.log.info(O),this.emits(["notice","_promiseSlowoff"],M);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(O),this.emits(["notice","_promiseTimeout"],M);break;case"untimeout_success":case"unban_success":this.log.info(O),this.emits(["notice","_promiseUnban"],U);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(O),this.emits(["notice","_promiseUnban"],M);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(O),this.emits(["notice","_promiseDeletemessage"],M);break;case"usage_unhost":case"not_hosting":this.log.info(O),this.emits(["notice","_promiseUnhost"],M);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(O),this.emits(["notice","_promiseWhisper"],M);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(O),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[H,[P,v]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(O),this.emit("automod",v,P,x);break;case"unrecognized_cmd":this.log.info(O),this.emit("notice",v,P,x);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(O),this.emit("notice",v,P,x);break;case"host_on":case"host_off":break;default:x.includes("Login unsuccessful")||x.includes("Login authentication failed")||x.includes("Error logging in")||x.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=x,this.log.error(this.reason),this.ws.close()):x.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
`.concat(JSON.stringify(e,null,4))),this.emit("notice",v,P,x))}break;case"USERNOTICE":var z=I["display-name"]||I.login,se=I["msg-param-sub-plan"]||"",oe=w.unescapeIRC(w.get(I["msg-param-sub-plan-name"],""))||null,ee={prime:se.includes("Prime"),plan:se,planName:oe},be=~~(I["msg-param-streak-months"]||0),xe=I["msg-param-recipient-display-name"]||I["msg-param-recipient-user-name"],Ee=~~I["msg-param-mass-gift-count"];switch(I["message-type"]=P){case"resub":this.emits(["resub","subanniversary"],[[v,z,be,x,I,ee]]);break;case"sub":this.emits(["subscription","sub"],[[v,z,ee,x,I]]);break;case"subgift":this.emit("subgift",v,z,be,xe,ee,I);break;case"anonsubgift":this.emit("anonsubgift",v,be,xe,ee,I);break;case"submysterygift":this.emit("submysterygift",v,z,Ee,ee,I);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",v,Ee,ee,I);break;case"primepaidupgrade":this.emit("primepaidupgrade",v,z,ee,I);break;case"giftpaidupgrade":var ve=I["msg-param-sender-name"]||I["msg-param-sender-login"];this.emit("giftpaidupgrade",v,z,ve,I);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",v,z,I);break;case"raid":var ve=I["msg-param-displayName"]||I["msg-param-login"],he=+I["msg-param-viewerCount"];this.emit("raided",v,ve,he,I);break;case"ritual":he=I["msg-param-ritual-name"],he==="new_chatter"?this.emit("newchatter",v,z,I,x):this.emit("ritual",he,v,z,I,x);break;default:this.emit("usernotice",P,v,I,x)}break;case"HOSTTARGET":var oe=x.split(" "),ae=~~oe[1]||0;oe[0]==="-"?(this.log.info("[".concat(v,"] Exited host mode.")),this.emits(["unhost","_promiseUnhost"],[[v,ae],[null]])):(this.log.info("[".concat(v,"] Now hosting ").concat(oe[0]," for ").concat(ae," viewer(s).")),this.emit("hosting",v,oe[0],ae));break;case"CLEARCHAT":1<e.params.length?(b=w.get(e.tags["ban-duration"],null))===null?(this.log.info("[".concat(v,"] ").concat(x," has been banned.")),this.emit("ban",v,x,null,e.tags)):(this.log.info("[".concat(v,"] ").concat(x," has been timed out for ").concat(b," seconds.")),this.emit("timeout",v,x,null,~~b,e.tags)):(this.log.info("[".concat(v,"] Chat was cleared by a moderator.")),this.emits(["clearchat","_promiseClear"],[[v],[null]]));break;case"CLEARMSG":1<e.params.length&&(ae=x,b=I.login,I["message-type"]="messagedeleted",this.log.info("[".concat(v,"] ").concat(b,"'s message has been deleted.")),this.emit("messagedeleted",v,b,ae,I));break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.disconnect().catch(function(J){return u.log.error(J)}),setTimeout(function(){return u.connect().catch(function(J){return u.log.error(J)})},this.reconnectTimer);break;case"USERSTATE":e.tags.username=this.username,e.tags["user-type"]==="mod"&&(this.moderators[v]||(this.moderators[v]=[]),this.moderators[v].includes(this.username)||this.moderators[v].push(this.username)),w.isJustinfan(this.getUsername())||this.userstate[v]||(this.userstate[v]=I,this.lastJoined=v,this.channels.push(v),this.log.info("Joined ".concat(v)),this.emit("join",v,w.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[v]=I;break;case"GLOBALUSERSTATE":this.globaluserstate=I,this.emit("globaluserstate",I),e.tags["emote-sets"]!==void 0&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":w.channel(this.lastJoined)===v&&this.emit("_promiseJoin",null,v),e.tags.channel=v,this.emit("roomstate",v,e.tags),w.hasOwn(e.tags,"subs-only")||(w.hasOwn(e.tags,"slow")&&(typeof e.tags.slow!="boolean"||e.tags.slow?(D=[v,!0,~~e.tags.slow],this.log.info("[".concat(v,"] This room is now in slow mode.")),this.emits(["slow","slowmode","_promiseSlow"],[D,D,[null]])):(D=[v,!1,0],this.log.info("[".concat(v,"] This room is no longer in slow mode.")),this.emits(["slow","slowmode","_promiseSlowoff"],[D,D,[null]]))),w.hasOwn(e.tags,"followers-only")&&(e.tags["followers-only"]==="-1"?(A=[v,!1,0],this.log.info("[".concat(v,"] This room is no longer in followers-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[A,A,[null]])):(A=[v,!0,~~e.tags["followers-only"]],this.log.info("[".concat(v,"] This room is now in follower-only mode.")),this.emits(["followersonly","followersmode","_promiseFollowers"],[A,A,[null]]))));break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
`.concat(JSON.stringify(e,null,4)))}else if(e.prefix==="jtv")e.command==="MODE"?x==="+o"?(this.moderators[v]||(this.moderators[v]=[]),this.moderators[v].includes(e.params[2])||this.moderators[v].push(e.params[2]),this.emit("mod",v,e.params[2])):x==="-o"&&(this.moderators[v]||(this.moderators[v]=[]),this.moderators[v].filter(function(J){return J!==e.params[2]}),this.emit("unmod",v,e.params[2])):this.log.warn(`Could not parse message from jtv:
`.concat(JSON.stringify(e,null,4)));else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":var Y=e.prefix.split("!")[0];w.isJustinfan(this.getUsername())&&this.username===Y&&(this.lastJoined=v,this.channels.push(v),this.log.info("Joined ".concat(v)),this.emit("join",v,Y,!0)),this.username!==Y&&this.emit("join",v,Y,!1);break;case"PART":var te=!1,Ie=e.prefix.split("!")[0];this.username===Ie&&(te=!0,this.userstate[v]&&delete this.userstate[v],(Y=this.channels.indexOf(v))!==-1&&this.channels.splice(Y,1),(Y=this.opts.channels.indexOf(v))!==-1&&this.opts.channels.splice(Y,1),this.log.info("Left ".concat(v)),this.emit("_promisePart",null)),this.emit("part",v,Ie,te);break;case"WHISPER":te=e.prefix.split("!")[0],this.log.info("[WHISPER] <".concat(te,">: ").concat(x)),w.hasOwn(e.tags,"username")||(e.tags.username=te),e.tags["message-type"]="whisper",te=w.channel(e.tags.username),this.emits(["whisper","message"],[[te,e.tags,x,!1]]);break;case"PRIVMSG":e.tags.username=e.prefix.split("!")[0],e.tags.username==="jtv"?(L=w.username(x.split(" ")[0]),j=x.includes("auto"),x.includes("hosting you for")?(R=w.extractNumber(x),this.emit("hosted",v,L,R,j)):x.includes("hosting you")&&this.emit("hosted",v,L,0,j)):(R=w.get(this.opts.options.messagesLogLevel,"info"),L=w.actionMessage(x),e.tags["message-type"]=L?"action":"chat",x=L?L[1]:x,w.hasOwn(e.tags,"bits")?this.emit("cheer",v,e.tags,x):(w.hasOwn(e.tags,"msg-id")?e.tags["msg-id"]==="highlighted-message"?(j=e.tags["msg-id"],this.emit("redeem",v,e.tags.username,j,e.tags,x)):e.tags["msg-id"]==="skip-subs-mode-message"&&(N=e.tags["msg-id"],this.emit("redeem",v,e.tags.username,N,e.tags,x)):w.hasOwn(e.tags,"custom-reward-id")&&(N=e.tags["custom-reward-id"],this.emit("redeem",v,e.tags.username,N,e.tags,x)),L?(this.log[R]("[".concat(v,"] *<").concat(e.tags.username,">: ").concat(x)),this.emits(["action","message"],[[v,e.tags,x,!1]])):(this.log[R]("[".concat(v,"] <").concat(e.tags.username,">: ").concat(x)),this.emits(["chat","message"],[[v,e.tags,x,!1]]))));break;default:this.log.warn(`Could not parse message:
`.concat(JSON.stringify(e,null,4)))}}},s.prototype.connect=function(){var e=this;return new Promise(function(u,d){e.server=w.get(e.opts.connection.server,"irc-ws.chat.twitch.tv"),e.port=w.get(e.opts.connection.port,80),e.secure&&(e.port=443),e.port===443&&(e.secure=!0),e.reconnectTimer=e.reconnectTimer*e.reconnectDecay,e.reconnectTimer>=e.maxReconnectInterval&&(e.reconnectTimer=e.maxReconnectInterval),e._openConnection(),e.once("_promiseConnect",function(g){g?d(g):u([e.server,~~e.port])})})},s.prototype._openConnection=function(){var e="".concat(this.secure?"wss":"ws","://").concat(this.server,":").concat(this.port,"/"),u={};"agent"in this.opts.connection&&(u.agent=this.opts.connection.agent),this.ws=new t(e,"irc",u),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},s.prototype._onOpen=function(){var e=this;this._isConnected()&&(this.log.info("Connecting to ".concat(this.server," on port ").concat(this.port,"..")),this.emit("connecting",this.server,~~this.port),this.username=w.get(this.opts.identity.username,w.justinfan()),this._getToken().then(function(u){var d=w.password(u);e.log.info("Sending authentication to server.."),e.emit("logon"),u="twitch.tv/tags twitch.tv/commands",e._skipMembership||(u+=" twitch.tv/membership"),e.ws.send("CAP REQ :"+u),d?e.ws.send("PASS ".concat(d)):w.isJustinfan(e.username)&&e.ws.send("PASS SCHMOOPIIE"),e.ws.send("NICK ".concat(e.username))}).catch(function(u){e.emits(["_promiseConnect","disconnected"],[[u],["Could not get a token."]])}))},s.prototype._getToken=function(){var e,u=this.opts.identity.password;return typeof u=="function"?(e=u())instanceof Promise?e:Promise.resolve(e):Promise.resolve(u)},s.prototype._onMessage=function(e){var u=this;e.data.trim().split(`\r
`).forEach(function(d){d=m.msg(d),d&&u.handleMessage(d)})},s.prototype._onError=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect().catch(function(u){return e.log.error(u)})},this.reconnectTimer)),this.ws=null},s.prototype._onClose=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in ".concat(Math.round(this.reconnectTimer/1e3)," seconds..")),this.emit("reconnect"),setTimeout(function(){e.reconnecting=!1,e.connect().catch(function(u){return e.log.error(u)})},this.reconnectTimer))),this.ws=null},s.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},s.prototype._sendCommand=function(e,u,d,g){var b=this;return new Promise(function(D,A){if(!b._isConnected())return A("Not connected to server.");var R;e!==null&&typeof e!="number"||(e===null&&(e=b._getPromiseDelay()),w.promiseDelay(e).then(function(){return A("No response from Twitch.")})),u!==null?(R=w.channel(u),b.log.info("[".concat(R,"] Executing command: ").concat(d)),b.ws.send("PRIVMSG ".concat(R," :").concat(d))):(b.log.info("Executing command: ".concat(d)),b.ws.send(d)),typeof g=="function"?g(D,A):D()})},s.prototype._sendMessage=function(e,u,d,g){var b=this;return new Promise(function(D,A){if(!b._isConnected())return A("Not connected to server.");if(w.isJustinfan(b.getUsername()))return A("Cannot send anonymous messages.");var R,L=w.channel(u);b.userstate[L]||(b.userstate[L]={}),500<=d.length&&(R=w.splitLine(d,500),d=R[0],setTimeout(function(){b._sendMessage(e,u,R[1],function(){})},350)),b.ws.send("PRIVMSG ".concat(L," :").concat(d));var j={};Object.keys(b.emotesets).forEach(function(P){return b.emotesets[P].forEach(function(I){return(w.isRegex(I.code)?m.emoteRegex:m.emoteString)(d,I.code,I.id,j)})});var N=Object.assign(b.userstate[L],m.emotes({emotes:m.transformEmotes(j)||null})),v=w.get(b.opts.options.messagesLogLevel,"info"),x=w.actionMessage(d);x?(N["message-type"]="action",b.log[v]("[".concat(L,"] *<").concat(b.getUsername(),">: ").concat(x[1])),b.emits(["action","message"],[[L,N,x[1],!0]])):(N["message-type"]="chat",b.log[v]("[".concat(L,"] <").concat(b.getUsername(),">: ").concat(d)),b.emits(["chat","message"],[[L,N,d,!0]])),typeof g=="function"?g(D,A):D()})},s.prototype._updateEmoteset=function(e){var u,d=this,g=e!==void 0;g&&(e===this.emotes?g=!1:this.emotes=e),this._skipUpdatingEmotesets?g&&this.emit("emotesets",e,{}):(u=function(){0<d._updateEmotesetsTimerDelay&&(clearTimeout(d._updateEmotesetsTimer),d._updateEmotesetsTimer=setTimeout(function(){return d._updateEmoteset(e)},d._updateEmotesetsTimerDelay))},this._getToken().then(function(b){var D="https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=".concat(e),A={};return"fetchAgent"in d.opts.connection&&(A.agent=d.opts.connection.fetchAgent),o(D,T(T({},A),{},{headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:"OAuth ".concat(w.token(b)),"Client-ID":d.clientId}}))}).then(function(b){return b.json()}).then(function(b){d.emotesets=b.emoticon_sets||{},d.emit("emotesets",e,d.emotesets),u()}).catch(u))},s.prototype.getUsername=function(){return this.username},s.prototype.getOptions=function(){return this.opts},s.prototype.getChannels=function(){return this.channels},s.prototype.isMod=function(e,u){return e=w.channel(e),this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(w.username(u))},s.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},s.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},s.prototype.disconnect=function(){var e=this;return new Promise(function(u,d){e.ws!==null&&e.ws.readyState!==3?(e.wasCloseCalled=!0,e.log.info("Disconnecting from server.."),e.ws.close(),e.once("_promiseDisconnect",function(){return u([e.server,~~e.port])})):(e.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),d("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},s.prototype.off=s.prototype.removeListener,c!==void 0&&c.exports&&(c.exports=s),typeof window<"u"&&(window.tmi={client:s,Client:s})}).call(this)}).call(this,typeof $<"u"?$:typeof self<"u"?self:typeof window<"u"?window:{})},{"./api":2,"./commands":4,"./events":5,"./logger":6,"./parser":7,"./timer":8,"./utils":9,"node-fetch":10,ws:10}],4:[function(S,c,y){var l=S("./utils");function k(t,o){var f=this;return t=l.channel(t),o=l.get(o,30),this._sendCommand(null,t,"/followers ".concat(o),function(i,r){f.once("_promiseFollowers",function(n){n?r(n):i([t,~~o])})})}function T(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/followersoff",function(f,i){o.once("_promiseFollowersoff",function(r){r?i(r):f([t])})})}function _(t){var o=this;return t=l.channel(t),this._sendCommand(null,null,"PART ".concat(t),function(f,i){o.once("_promisePart",function(r){r?i(r):f([t])})})}function p(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/r9kbeta",function(f,i){o.once("_promiseR9kbeta",function(r){r?i(r):f([t])})})}function s(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/r9kbetaoff",function(f,i){o.once("_promiseR9kbetaoff",function(r){r?i(r):f([t])})})}function a(t,o){var f=this;return t=l.channel(t),o=l.get(o,300),this._sendCommand(null,t,"/slow ".concat(o),function(i,r){f.once("_promiseSlow",function(n){n?r(n):i([t,~~o])})})}function h(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/slowoff",function(f,i){o.once("_promiseSlowoff",function(r){r?i(r):f([t])})})}c.exports={action:function(t,o){return t=l.channel(t),o="ACTION ".concat(o,""),this._sendMessage(this._getPromiseDelay(),t,o,function(f,i){f([t,o])})},ban:function(t,o,f){var i=this;return t=l.channel(t),o=l.username(o),f=l.get(f,""),this._sendCommand(null,t,"/ban ".concat(o," ").concat(f),function(r,n){i.once("_promiseBan",function(m){m?n(m):r([t,o,f])})})},clear:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/clear",function(f,i){o.once("_promiseClear",function(r){r?i(r):f([t])})})},color:function(t,o){var f=this;return o=l.get(o,t),this._sendCommand(null,"#tmijs","/color ".concat(o),function(i,r){f.once("_promiseColor",function(n){n?r(n):i([o])})})},commercial:function(t,o){var f=this;return t=l.channel(t),o=l.get(o,30),this._sendCommand(null,t,"/commercial ".concat(o),function(i,r){f.once("_promiseCommercial",function(n){n?r(n):i([t,~~o])})})},deletemessage:function(t,o){var f=this;return t=l.channel(t),this._sendCommand(null,t,"/delete ".concat(o),function(i,r){f.once("_promiseDeletemessage",function(n){n?r(n):i([t])})})},emoteonly:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/emoteonly",function(f,i){o.once("_promiseEmoteonly",function(r){r?i(r):f([t])})})},emoteonlyoff:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/emoteonlyoff",function(f,i){o.once("_promiseEmoteonlyoff",function(r){r?i(r):f([t])})})},followersonly:k,followersmode:k,followersonlyoff:T,followersmodeoff:T,host:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(2e3,t,"/host ".concat(o),function(i,r){f.once("_promiseHost",function(n,m){n?r(n):i([t,o,~~m])})})},join:function(t){var o=this;return t=l.channel(t),this._sendCommand(void 0,null,"JOIN ".concat(t),function(f,i){var r="_promiseJoin",n=!1,m=function C(w,E){t===l.channel(E)&&(o.removeListener(r,C),n=!0,w?i(w):f([t]))};o.on(r,m),m=o._getPromiseDelay(),l.promiseDelay(m).then(function(){n||o.emit(r,"No response from Twitch.",t)})})},mod:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(null,t,"/mod ".concat(o),function(i,r){f.once("_promiseMod",function(n){n?r(n):i([t,o])})})},mods:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/mods",function(f,i){o.once("_promiseMods",function(r,n){r?i(r):(n.forEach(function(m){o.moderators[t]||(o.moderators[t]=[]),o.moderators[t].includes(m)||o.moderators[t].push(m)}),f(n))})})},part:_,leave:_,ping:function(){var t=this;return this._sendCommand(null,null,"PING",function(o,f){t.latency=new Date,t.pingTimeout=setTimeout(function(){t.ws!==null&&(t.wasCloseCalled=!1,t.log.error("Ping timeout."),t.ws.close(),clearInterval(t.pingLoop),clearTimeout(t.pingTimeout))},l.get(t.opts.connection.timeout,9999)),t.once("_promisePing",function(i){return o([parseFloat(i)])})})},r9kbeta:p,r9kmode:p,r9kbetaoff:s,r9kmodeoff:s,raw:function(t){return this._sendCommand(null,null,t,function(o,f){o([t])})},say:function(t,o){return t=l.channel(t),o.startsWith(".")&&!o.startsWith("..")||o.startsWith("/")||o.startsWith("\\")?o.substr(1,3)==="me "?this.action(t,o.substr(4)):this._sendCommand(null,t,o,function(f,i){f([t,o])}):this._sendMessage(this._getPromiseDelay(),t,o,function(f,i){f([t,o])})},slow:a,slowmode:a,slowoff:h,slowmodeoff:h,subscribers:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/subscribers",function(f,i){o.once("_promiseSubscribers",function(r){r?i(r):f([t])})})},subscribersoff:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/subscribersoff",function(f,i){o.once("_promiseSubscribersoff",function(r){r?i(r):f([t])})})},timeout:function(t,o,f,i){var r=this;return t=l.channel(t),o=l.username(o),f===null||l.isInteger(f)||(i=f,f=300),f=l.get(f,300),i=l.get(i,""),this._sendCommand(null,t,"/timeout ".concat(o," ").concat(f," ").concat(i),function(n,m){r.once("_promiseTimeout",function(C){C?m(C):n([t,o,~~f,i])})})},unban:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(null,t,"/unban ".concat(o),function(i,r){f.once("_promiseUnban",function(n){n?r(n):i([t,o])})})},unhost:function(t){var o=this;return t=l.channel(t),this._sendCommand(2e3,t,"/unhost",function(f,i){o.once("_promiseUnhost",function(r){r?i(r):f([t])})})},unmod:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(null,t,"/unmod ".concat(o),function(i,r){f.once("_promiseUnmod",function(n){n?r(n):i([t,o])})})},unvip:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(null,t,"/unvip ".concat(o),function(i,r){f.once("_promiseUnvip",function(n){n?r(n):i([t,o])})})},vip:function(t,o){var f=this;return t=l.channel(t),o=l.username(o),this._sendCommand(null,t,"/vip ".concat(o),function(i,r){f.once("_promiseVip",function(n){n?r(n):i([t,o])})})},vips:function(t){var o=this;return t=l.channel(t),this._sendCommand(null,t,"/vips",function(f,i){o.once("_promiseVips",function(r,n){r?i(r):f(n)})})},whisper:function(t,o){var f=this;return(t=l.username(t))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs","/w ".concat(t," ").concat(o),function(i,r){f.once("_promiseWhisper",function(n){n&&r(n)})}).catch(function(n){if(n&&typeof n=="string"&&n.indexOf("No response from Twitch.")!==0)throw n;var r=l.channel(t),n=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:f.getUsername()},f.globaluserstate);return f.emits(["whisper","message"],[[r,n,o,!0],[r,n,o,!0]]),[t,o]})}}},{"./utils":9}],5:[function(S,c,y){function l(s){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(s)}function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function T(s){return typeof s=="function"}function _(s){return l(s)==="object"&&s!==null}function p(s){return s===void 0}((c.exports=k).EventEmitter=k).prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||isNaN(s))throw TypeError("n must be a positive number");return this._maxListeners=s,this},k.prototype.emit=function(s){var a,h,t,o,f,i;if(this._events||(this._events={}),s==="error"&&(!this._events.error||_(this._events.error)&&!this._events.error.length))throw(a=arguments[1])instanceof Error?a:TypeError('Uncaught, unspecified "error" event.');if(p(h=this._events[s]))return!1;if(T(h))switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),h.apply(this,o)}else if(_(h))for(o=Array.prototype.slice.call(arguments,1),t=(i=h.slice()).length,f=0;f<t;f++)i[f].apply(this,o);return!0},k.prototype.on=k.prototype.addListener=function(s,a){var h;if(!T(a))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,T(a.listener)?a.listener:a),this._events[s]?_(this._events[s])?this._events[s].push(a):this._events[s]=[this._events[s],a]:this._events[s]=a,_(this._events[s])&&!this._events[s].warned&&(h=p(this._maxListeners)?k.defaultMaxListeners:this._maxListeners)&&0<h&&this._events[s].length>h&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),typeof console.trace=="function"&&console.trace()),this},k.prototype.once=function(s,a){if(!T(a))throw TypeError("listener must be a function");var h=!1;if(this._events.hasOwnProperty(s)&&s.charAt(0)==="_"){var t,o=1,f=s;for(t in this._events)this._events.hasOwnProperty(t)&&t.startsWith(f)&&o++;s+=o}function i(){s.charAt(0)!=="_"||isNaN(s.substr(s.length-1))||(s=s.substring(0,s.length-1)),this.removeListener(s,i),h||(h=!0,a.apply(this,arguments))}return i.listener=a,this.on(s,i),this},k.prototype.removeListener=function(s,a){var h,t,o,f;if(!T(a))throw TypeError("listener must be a function");if(!this._events||!this._events[s])return this;if(o=(h=this._events[s]).length,t=-1,h===a||T(h.listener)&&h.listener===a){if(delete this._events[s],this._events.hasOwnProperty(s+"2")&&s.charAt(0)==="_"){var i,r=s;for(i in this._events)this._events.hasOwnProperty(i)&&i.startsWith(r)&&(isNaN(parseInt(i.substr(i.length-1)))||(this._events[s+parseInt(i.substr(i.length-1)-1)]=this._events[i],delete this._events[i]));this._events[s]=this._events[s+"1"],delete this._events[s+"1"]}this._events.removeListener&&this.emit("removeListener",s,a)}else if(_(h)){for(f=o;0<f--;)if(h[f]===a||h[f].listener&&h[f].listener===a){t=f;break}if(t<0)return this;h.length===1?(h.length=0,delete this._events[s]):h.splice(t,1),this._events.removeListener&&this.emit("removeListener",s,a)}return this},k.prototype.removeAllListeners=function(s){var a,h;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[s]&&delete this._events[s],this;if(arguments.length===0){for(a in this._events)a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events={},this}if(T(h=this._events[s]))this.removeListener(s,h);else if(h)for(;h.length;)this.removeListener(s,h[h.length-1]);return delete this._events[s],this},k.prototype.listeners=function(s){return s=this._events&&this._events[s]?T(this._events[s])?[this._events[s]]:this._events[s].slice():[],s},k.prototype.listenerCount=function(s){if(this._events){if(s=this._events[s],T(s))return 1;if(s)return s.length}return 0},k.listenerCount=function(s,a){return s.listenerCount(a)}},{}],6:[function(S,c,y){var l=S("./utils"),k="info",T={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function _(p){return function(s){T[k]<=T[p]&&console.log("[".concat(l.formatDate(new Date),"] ").concat(p,": ").concat(s))}}c.exports={setLevel:function(p){k=p},trace:_("trace"),debug:_("debug"),info:_("info"),warn:_("warn"),error:_("error"),fatal:_("fatal")}},{"./utils":9}],7:[function(S,c,y){var l=S("./utils"),k=/\S+/g;function T(_,p,t,i,h){var t=2<arguments.length&&t!==void 0?t:",",o=3<arguments.length&&i!==void 0?i:"/",f=4<arguments.length?h:void 0,i=_[p];if(i===void 0)return _;if(h=typeof i=="string",_[p+"-raw"]=h?i:null,i===!0)return _[p]=null,_;if(_[p]={},h)for(var r=i.split(t),n=0;n<r.length;n++){var m=r[n].split(o),C=m[1];f!==void 0&&C&&(C=C.split(f)),_[p][m[0]]=C||null}return _}c.exports={badges:function(_){return T(_,"badges")},badgeInfo:function(_){return T(_,"badge-info")},emotes:function(_){return T(_,"emotes","/",":",",")},emoteRegex:function(_,p,s,a){k.lastIndex=0;for(var h,t=new RegExp("(\\b|^|\\s)"+l.unescapeHtml(p)+"(\\b|$|\\s)");(h=k.exec(_))!==null;)t.test(h[0])&&(a[s]=a[s]||[],a[s].push([h.index,k.lastIndex-1]))},emoteString:function(_,p,s,a){var h;for(k.lastIndex=0;(h=k.exec(_))!==null;)h[0]===l.unescapeHtml(p)&&(a[s]=a[s]||[],a[s].push([h.index,k.lastIndex-1]))},transformEmotes:function(_){var p="";return Object.keys(_).forEach(function(s){p="".concat(p+s,":"),_[s].forEach(function(a){return p="".concat(p+a.join("-"),",")}),p="".concat(p.slice(0,-1),"/")}),p.slice(0,-1)},formTags:function(_){var p,s=[];for(p in _){var a=l.escapeIRC(_[p]);s.push("".concat(p,"=").concat(a))}return"@".concat(s.join(";"))},msg:function(_){var p={raw:_,tags:{},prefix:null,command:null,params:[]},s=0,a=0;if(_.charCodeAt(0)===64){if((a=_.indexOf(" "))===-1)return null;for(var h=_.slice(1,a).split(";"),t=0;t<h.length;t++){var o=h[t],f=o.split("=");p.tags[f[0]]=o.substring(o.indexOf("=")+1)||!0}s=a+1}for(;_.charCodeAt(s)===32;)s++;if(_.charCodeAt(s)===58){if((a=_.indexOf(" ",s))===-1)return null;for(p.prefix=_.slice(s+1,a),s=a+1;_.charCodeAt(s)===32;)s++}if((a=_.indexOf(" ",s))===-1)return _.length>s?(p.command=_.slice(s),p):null;for(p.command=_.slice(s,a),s=a+1;_.charCodeAt(s)===32;)s++;for(;s<_.length;){if(a=_.indexOf(" ",s),_.charCodeAt(s)===58){p.params.push(_.slice(s+1));break}if(a===-1){if(a===-1){p.params.push(_.slice(s));break}}else for(p.params.push(_.slice(s,a)),s=a+1;_.charCodeAt(s)===32;)s++}return p}}},{"./utils":9}],8:[function(S,c,y){function l(k,T){for(var _=0;_<T.length;_++){var p=T[_];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(k,p.key,p)}}c.exports=function(){function k(p){(function(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")})(this,k),this.queue=[],this.index=0,this.defaultDelay=p===void 0?3e3:p}var T,_;return T=k,(_=[{key:"add",value:function(p,s){this.queue.push({fn:p,delay:s})}},{key:"next",value:function(){var p,s=this,a=this.index++,a=this.queue[a];a&&(p=this.queue[this.index],a.fn(),p&&(a=p.delay===void 0?this.defaultDelay:p.delay,setTimeout(function(){return s.next()},a)))}}])&&l(T.prototype,_),k}()},{}],9:[function(S,c,y){(function(l){(function(){function k(n){return(k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(n)}var T,_=/^\u0001ACTION ([^\u0001]+)\u0001$/,p=/^(justinfan)(\d+$)/,s=/\\([sn:r\\])/g,a=/([ \n;\r\\])/g,h={s:" ",n:"",":":";",r:""},t={" ":"s","\n":"n",";":":","\r":"r"},o=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),f=/[|\\^$*+?:#]/,i=c.exports={get:function(n,m){return n===void 0?m:n},hasOwn:function(n,m){return{}.hasOwnProperty.call(n,m)},promiseDelay:function(n){return new Promise(function(m){return setTimeout(m,n)})},isFinite:(T=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},r.toString=function(){return T.toString()},r),toNumber:function(n,m){return n===null?0:(m=Math.pow(10,i.isFinite(m)?m:0),Math.round(n*m)/m)},isInteger:function(n){return!isNaN(i.toNumber(n,0))},isRegex:function(n){return f.test(n)},isURL:function(n){return o.test(n)},justinfan:function(){return"justinfan".concat(Math.floor(8e4*Math.random()+1e3))},isJustinfan:function(n){return p.test(n)},channel:function(n){var m;return(m=(n||"").toLowerCase())[0]==="#"?m:"#"+m},username:function(n){var m;return(m=(n||"").toLowerCase())[0]==="#"?m.slice(1):m},token:function(n){return n?n.toLowerCase().replace("oauth:",""):""},password:function(n){return n=i.token(n),n?"oauth:".concat(n):""},actionMessage:function(n){return n.match(_)},replaceAll:function(n,m){if(n==null)return null;for(var C in m)n=n.replace(new RegExp(C,"g"),m[C]);return n},unescapeHtml:function(n){return n.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(n){return n&&typeof n=="string"&&n.includes("\\")?n.replace(s,function(m,C){return C in h?h[C]:C}):n},escapeIRC:function(n){return n&&typeof n=="string"?n.replace(a,function(m,C){return C in t?"\\".concat(t[C]):C}):n},addWord:function(n,m){return n.length?n+" "+m:n+m},splitLine:function(n,m){var C=n.substring(0,m).lastIndexOf(" ");return[n.substring(0,C=C===-1?m-1:C),n.substring(C+1)]},extractNumber:function(n){for(var m=n.split(" "),C=0;C<m.length;C++)if(i.isInteger(m[C]))return~~m[C];return 0},formatDate:function(C){var m=C.getHours(),C=((C=C.getMinutes())<10?"0":"")+C;return"".concat(m=(m<10?"0":"")+m,":").concat(C)},inherits:function(n,m){n.super_=m;function C(){}C.prototype=m.prototype,n.prototype=new C,n.prototype.constructor=n},isNode:function(){try{return(l===void 0?"undefined":k(l))==="object"&&Object.prototype.toString.call(l)==="[object process]"}catch{}return!1}};function r(n){return T.apply(this,arguments)}}).call(this)}).call(this,S("_process"))},{_process:11}],10:[function(S,c,y){},{}],11:[function(S,T,y){var l,k,T=T.exports={};function _(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}function s(m){if(l===setTimeout)return setTimeout(m,0);if((l===_||!l)&&setTimeout)return l=setTimeout,setTimeout(m,0);try{return l(m,0)}catch{try{return l.call(null,m,0)}catch{return l.call(this,m,0)}}}(function(){try{l=typeof setTimeout=="function"?setTimeout:_}catch{l=_}try{k=typeof clearTimeout=="function"?clearTimeout:p}catch{k=p}})();var a,h=[],t=!1,o=-1;function f(){t&&a&&(t=!1,a.length?h=a.concat(h):o=-1,h.length&&i())}function i(){if(!t){var m=s(f);t=!0;for(var C=h.length;C;){for(a=h,h=[];++o<C;)a&&a[o].run();o=-1,C=h.length}a=null,t=!1,function(w){if(k===clearTimeout)return clearTimeout(w);if((k===p||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(w);try{k(w)}catch{try{return k.call(null,w)}catch{return k.call(this,w)}}}(m)}}function r(m,C){this.fun=m,this.array=C}function n(){}T.nextTick=function(m){var C=new Array(arguments.length-1);if(1<arguments.length)for(var w=1;w<arguments.length;w++)C[w-1]=arguments[w];h.push(new r(m,C)),h.length!==1||t||s(i)},r.prototype.run=function(){this.fun.apply(null,this.array)},T.title="browser",T.browser=!0,T.env={},T.argv=[],T.version="",T.versions={},T.on=n,T.addListener=n,T.once=n,T.off=n,T.removeListener=n,T.removeAllListeners=n,T.emit=n,T.prependListener=n,T.prependOnceListener=n,T.listeners=function(m){return[]},T.binding=function(m){throw new Error("process.binding is not supported")},T.cwd=function(){return"/"},T.chdir=function(m){throw new Error("process.chdir is not supported")},T.umask=function(){return 0}},{}]},{},[1]);var de={exports:{}};(function(S,c){var y=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof $<"u")return $;throw new Error("unable to locate global object")},l=y();S.exports=c=l.fetch,l.fetch&&(c.default=l.fetch.bind(l)),c.Headers=l.Headers,c.Request=l.Request,c.Response=l.Response})(de,de.exports);var De=de.exports,Ae=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};(function(S){var c=Le,y=De,l=Ae,k={global:{},users:{}},T=function(r,n){if(!r)return{any:null,user:null};var m=new Date,C={};return k.global[r]?C.any=m-k.global[r]:C.any=0,k.global[r]=m,n?(k.users[n]||(k.users[n]={}),k.users[n][r]?C.user=m-k.users[n][r]:C.user=0,k.users[n][r]=m):C.user=null,C};function _(r){for(var n="",m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",C=0;C<r;C++)n+=m.charAt(Math.floor(Math.random()*m.length));return n}async function p(r,n){let w;n=n.replace("oauth:","");let E=await y("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${n}`}}).then(g=>g.json());if(!E.client_id||!E.scopes.includes("channel:read:redemptions")||!E.scopes.includes("user:read:email")){console.error("Invalid Password or Permission Scopes (channel:read:redemptions, user:read:email)");return}let u=(await y("https://api.twitch.tv/helix/users?login="+r,{headers:{"Client-ID":E.client_id,Authorization:`Bearer ${n}`}}).then(g=>g.json())).data[0].id,d;typeof window<"u"?d=new WebSocket("wss://pubsub-edge.twitch.tv"):d=new l,d.onopen=function(g){d.send(JSON.stringify({type:"PING"})),w=setInterval(()=>{d.send(JSON.stringify({type:"PING"}))},6e4);let b={type:"LISTEN",nonce:_(15),data:{topics:[`channel-points-channel-v1.${u}`],auth_token:n}};d.send(JSON.stringify(b))},d.onerror=function(g){console.error(g)},d.onmessage=function(g){switch(message=JSON.parse(g.data),message.type){case"RESPONSE":message.error==="ERR_BADAUTH"&&console.error("PubSub Authentication Failure");break;case"RECONNECT":setTimeout(()=>{p(r,n)},3e3);break;case"MESSAGE":if(message.data.topic.startsWith("channel-points-channel")){let R=JSON.parse(message.data.message);if(R.type==="reward-redeemed"){let L=R.data.redemption;var b=L.reward,D={id:b.id,channelId:b.channel_id,title:b.title,prompt:b.prompt,cost:b.cost,userInputRequired:b.is_user_input_required,subOnly:b.is_sub_only,image:{url1x:b.image?b.image.url_1x:null,url2x:b.image?b.image.url_2x:null,url4x:b.image?b.image.url_4x:null},defaultImage:{url1x:b.default_image.url_1x,url2x:b.default_image.url_2x,url4x:b.default_image.url_4x},backgroundColor:b.background_color,enabled:b.is_enabled,paused:b.is_paused,inStock:b.is_in_stock,maxPerStream:{enabled:b.max_per_stream.is_enabled,maxPerStream:b.max_per_stream.max_per_stream},shouldRedemptionsSkipRequestQueue:b.should_redemptions_skip_request_queue,templateId:b.template_id,updatedForIndicatorAt:b.updated_for_indicator_at,maxPerUserPerStream:{enabled:b.max_per_user_per_stream.is_enabled,maxPerUserPerStream:b.max_per_user_per_stream.max_per_user_per_stream},globalCooldown:{enabled:b.global_cooldown.is_enabled,globalCooldownSeconds:b.global_cooldown.global_cooldown_seconds},redemptionsRedeemedCurrentStream:b.redemptions_redeemed_current_stream,cooldownExpiresAt:b.cooldown_expires_at},A={channelId:L.channel_id,reward:D,rewardFulfilled:L.status==="FULFILLED",userId:L.user.id,username:L.user.login,displayName:L.user.display_name,customRewardId:L.id,timestamp:L.redeemed_at};i.onReward(L.user.display_name||L.user.login,L.reward.title,L.reward.cost,L.user_input||"",A)}}break}},d.onclose=function(){clearInterval(w),setTimeout(()=>{p(r,n)},3e3)}}var s="",a="",h=null,t=null,o=!0,f=0,i={isDebug:!1,chatModes:{},version:function(){return"@VERSION"},onError:function(r){console.error("Error:",r)},onCommand:function(r,n,m,C,w){i.isDebug&&console.log("onCommand default handler")},onChat:function(r,n,m,C,w){i.isDebug&&console.log("onChat default handler")},onWhisper:function(r,n,m,C,w){i.isDebug&&console.log("onWhisper default handler")},onMessageDeleted:function(r,n){i.isDebug&&console.log("onMessageDeleted default handler")},onBan:function(r,n){i.isDebug&&console.log("onBan default handler")},onTimeout:function(r,n,m){i.isDebug&&console.log("onTimeout default handler")},onJoin:function(r,n,m){i.isDebug&&console.log("onJoin default handler")},onPart:function(r,n,m){i.isDebug&&console.log("onPart default handler")},onHosted:function(r,n,m,C){i.isDebug&&console.log("onHosted default handler")},onRaid:function(r,n,m){i.isDebug&&console.log("onRaid default handler")},onSub:function(r,n,m,C){i.isDebug&&console.log("onSub default handler")},onResub:function(r,n,m,C,w,E){i.isDebug&&console.log("onResub default handler")},onSubGift:function(r,n,m,C,w,E){i.isDebug&&console.log("onSubGift default handler")},onSubMysteryGift:function(r,n,m,C,w){i.isDebug&&console.log("onSubMysteryGift default handler")},onGiftSubContinue:function(r,n,m){i.isDebug&&console.log("onGiftSubContinue default handler")},onCheer:function(r,n,m,C,w){i.isDebug&&console.log("onCheer default handler")},onChatMode:function(r,n){i.isDebug&&console.log("onChatMode default handler")},onReward:function(r,n,m,C,w){i.isDebug&&console.log("onReward default handler")},onConnected:function(r,n,m){},onReconnect:function(r){},Say:function(r,n){return t?(n||(n=s),t.say(n,r).catch(i.onError),!0):!1},Whisper:function(r,n){return t?(t.whisper(n,r).catch(i.onError),!0):!1},Announce:function(r,n,m=null){return t?(n||(n=s),t.say(n,`/announce ${r}`).catch(i.onError),!0):!1},DeleteMessage:function(r,n){return t?(n||(n=s),t.deletemessage(n,r).catch(i.onError),!0):!1},GetClient:function(){return t},Init:function(r,n,m,C){if(m=m||[r],(typeof m=="string"||m instanceof String)&&(m=[m]),!Array.isArray(m))throw new Error("Channels is not an array");i.isDebug=C,s=m[0];var w={options:{debug:C,skipUpdatingEmotesets:!0},connection:{reconnect:!0,secure:!0},channels:m};n&&(w.identity={username:r,password:n},a=n),t=new c.client(w),t.on("roomstate",function(E,e){try{var u=E.replace("#","");i.chatModes[u]=i.chatModes[u]||{},"emote-only"in e&&(i.chatModes[u].emoteOnly=e["emote-only"]),"followers-only"in e&&(i.chatModes[u].followerOnly=e["followers-only"]>=0),"subs-only"in e&&(i.chatModes[u].subOnly=e["subs-only"]),"r9k"in e&&(i.chatModes[u].r9kMode=e.r9k),"slow"in e&&(i.chatModes[u].slowMode=e.slow),i.onChatMode(i.chatModes[u],u)}catch(d){i.onError(d)}}),t.on("message",function(E,e,u,d){try{var g=e["display-name"]||e.username||r,b="#"+e.username===E,D=e.mod,A=e.badges&&e.badges.founder==="0",R=A||e.badges&&typeof e.badges.subscriber<"u"||e.subscriber,L=e.badges&&e.badges.vip==="1"||!1,j=e["msg-id"]==="highlighted-message",N=e["user-id"],v=e.id,x=e["room-id"],P=e.badges,I=e.color,_e=e.emotes,ue=e.flags,me=e["tmi-sent-ts"],re=e["emote-only"]||!1,G=e["message-type"],H=e["custom-reward-id"]||null,W={broadcaster:b,mod:D,founder:A,subscriber:R||A,vip:L,highlighted:j,customReward:!!H},B={id:v,channel:E.replace("#",""),roomId:x,messageType:G,messageEmotes:_e,isEmoteOnly:re,userId:N,username:e.username,displayName:e["display-name"],userColor:I,userBadges:P,userState:e,customRewardId:H,flags:ue,timestamp:me};if(!d&&u[0]==="!"){var U=u.split(/ (.*)/),M=U[0].slice(1).toLowerCase(),O=U[1]||"";B.sinceLastCommand=T(M,N),i.onCommand(g,M,O,W,B)}else G==="action"||G==="chat"?i.onChat(g,u,W,d,B):G==="whisper"&&i.onWhisper(g,u,W,d,B)}catch(X){i.onError(X)}}),t.on("messagedeleted",function(E,e,u,d){try{var g=d["target-msg-id"],b=d["room-id"],D={id:g,roomId:b,username:e,message:u};i.onMessageDeleted(g,D)}catch(A){i.onError(A)}}),t.on("ban",function(E,e,u,d){try{var g=e,b=d["room-id"],D=d["target-user-id"],A={roomId:b,username:e,bannedUserId:D};i.onBan(g,A)}catch(R){i.onError(R)}}),t.on("timeout",function(E,e,u,d,g){try{var b=e,D=d,A=g["room-id"],R=g["target-user-id"],L={roomId:A,username:e,timedOutUserId:R};i.onTimeout(b,D,L)}catch(j){i.onError(j)}}),t.on("join",function(E,e,u){var d={channel:E.replace("#","")};i.onJoin(e,u,d)}),t.on("part",function(E,e,u){var d={channel:E.replace("#","")};i.onPart(e,u,d)}),t.on("hosted",function(E,e,u,d){var g={channel:E.replace("#","")};i.onHosted(e,u,d,g)}),t.on("raided",function(E,e,u){var d={channel:E.replace("#","")};i.onRaid(e,u,d)}),t.on("cheer",function(E,e,u){var d=~~e.bits,g=e["room-id"],b=e["display-name"]||e.username||e.login,D=e["user-id"],A="#"+e.username===E,R=e.mod,L=e.badges&&e.badges.founder==="0",j=L||e.badges&&typeof e.badges.subscriber<"u"||e.subscriber,N=e.badges&&e.badges.vip==="1"||!1,v={broadcaster:A,mod:R,founder:L,subscriber:j,vip:N},x={id:e.id,channel:E.replace("#",""),roomId:g,userId:D,username:e.username,userColor:e.color,userBadges:e.badges,userState:e,displayName:e["display-name"],messageEmotes:e.emotes,subscriber:e.subscriber};i.onCheer(b,u,d,v,x)}),t.on("subscription",function(E,e,u,d,g){var b={id:g.id,roomId:g["room-id"],messageType:g["message-type"],messageEmotes:g.emotes,userId:g["user-id"],username:g.login,displayName:g["display-name"],userColor:g.color,userBadges:g.badges,userState:g,channel:E.replace("#","")};i.onSub(e,d,u,b)}),t.on("resub",function(E,e,u,d,g,b){var D=~~g["msg-param-cumulative-months"],A={id:g.id,roomId:g["room-id"],messageType:g["message-type"],messageEmotes:g.emotes,userId:g["user-id"],username:g.login,displayName:g["display-name"],userColor:g.color,userBadges:g.badges,channel:E.replace("#","")};i.onResub(e,d,u,D,b,A)}),t.on("subgift",function(E,e,u,d,g,b){var D=~~b["msg-param-sender-count"],A={id:b.id,roomId:b["room-id"],messageType:b["message-type"],messageEmotes:b.emotes,userId:b["user-id"],username:b.login,displayName:b["display-name"],userColor:b.color,userBadges:b.badges,userState:b,recipientDisplayName:b["msg-param-recipient-display-name"],recipientUsername:b["msg-param-recipient-user-name"],recipientId:b["msg-param-recipient-id"],channel:E.replace("#","")};i.onSubGift(e,u,d,D,g,A)}),t.on("submysterygift",function(E,e,u,d,g){var b=~~g["msg-param-sender-count"],D={id:g.id,roomId:g["room-id"],messageType:g["message-type"],messageEmotes:g.emotes,userId:g["user-id"],username:g.login,displayName:g["display-name"],userColor:g.color,userBadges:g.badges,userState:g,recipientDisplayName:g["msg-param-recipient-display-name"],recipientUsername:g["msg-param-recipient-user-name"],recipientId:g["msg-param-recipient-id"],userMassGiftCount:~~g["msg-param-mass-gift-count"],channel:E.replace("#","")};i.onSubMysteryGift(e,u,b,d,D)}),t.on("giftpaidupgrade",function(E,e,u,d){var g={id:d.id,roomId:d["room-id"],messageType:d["message-type"],messageEmotes:d.emotes,userId:d["user-id"],username:d.login,displayName:d["display-name"],userColor:d.color,userBadges:d.badges,userState:d,gifterUsername:d["msg-param-sender-login"],gifterDisplayName:d["msg-param-sender-name"],channel:E.replace("#","")};i.onGiftSubContinue(e,u,g)}),t.on("connected",function(E,e){console.log("Connected:"+E+":"+e),i.onConnected(E,e,o),o=!1}),t.on("reconnect",function(){console.log("Reconnecting"),f++,i.onReconnect(f)}),t.connect().catch(i.onError),n&&p(s,n)},Disconnect:function(){t.disconnect().catch(i.onError)},GetChannelRewards:async function(r,n=!1){return a?(h||(h=(await y(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(w=>w.json())).data[0]),(await y(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${h.id}&only_manageable_rewards=${n}`,{headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(C=>C.json())).data||[]):[]},CreateChannelReward:async function(r,n){if(a)return h||(h=(await y(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(w=>w.json())).data[0]),(await y(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${h.id}`,{method:"POST",headers:{"Client-ID":r,Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(C=>C.json())).data[0];throw new Error("Missing Channel Password")},UpdateChannelReward:async function(r,n,m){if(a)return h||(h=(await y(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(E=>E.json())).data[0]),(await y(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${h.id}&id=${n}`,{method:"PATCH",headers:{"Client-ID":r,Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(m)}).then(w=>w.json())).data[0];throw new Error("Missing Channel Password")},DeleteChannelReward:async function(r,n){if(a)return h||(h=(await y(`https://api.twitch.tv/helix/users?login=${s}`,{headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(w=>w.json())).data[0]),await y(`https://api.twitch.tv/helix/channel_points/custom_rewards?broadcaster_id=${h.id}&id=${n}`,{method:"DELETE",headers:{"Client-ID":r,Authorization:`Bearer ${a}`}}).then(C=>C.text());throw new Error("Missing Channel Password")}};S.exports&&(S.exports=i),typeof window<"u"&&(window.ComfyJS=i,c=window.tmi)})(K);var Re=K.exports;const fe=q(Re);class we{constructor(c,y){this.username=this.validateUsername(c),this.userColor=(y==null?void 0:y.userColor)||"",this.tasks=[]}validateUsername(c){if(typeof c!="string")throw new Error("Username must be of type string");if(c=c.trim(),c.length===0)throw new Error("Username invalid");return c}addTask(c){return this.tasks.push(c),c}editTask(c,y){let l=this.getTask(c);return l.setDescription(y),l}completeTask(c){let y=this.getTask(c);return y.setCompletionStatus(!0),y}deleteTask(c){Array.isArray(c)||(c=[c]),c.forEach(l=>this.validateTaskIndex(l));const y=[];return this.tasks=this.tasks.filter((l,k)=>{if(c.includes(k))y.push(l);else return!0}),y}clearDoneTasks(){return this.tasks=this.tasks.filter(c=>!c.isComplete()),this.tasks}getTask(c){return this.validateTaskIndex(c),this.tasks[c]}getTasks(){return this.tasks}validateTaskIndex(c){if(typeof c!="number"||isNaN(c))throw new Error("Task index must be a number");if(c<0||c>=this.tasks.length)throw new Error("Task index out of bounds");return!0}}class ke{constructor(c){this.description=this.validateDescription(c),this.completionStatus=!1}validateDescription(c){if(typeof c!="string")throw new Error("Task description must be of type string");if(c=c.trim(),c.length===0)throw new Error("Task description invalid");return c}getDescription(){return this.description}setDescription(c){this.description=this.validateDescription(c)}isComplete(){return this.completionStatus}setCompletionStatus(c){if(typeof c!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=c}}class Me{constructor(){ye(this,le);ye(this,F);this.users=V(this,le,Oe).call(this)}getUser(c){return this.users.find(l=>l.username===c)}getAllUsers(){return this.users}createUser(c,y){if(this.getUser(c))throw new Error(`${c} already exists`);const l=new we(c,y);return this.users.push(l),l}addUserTasks(c,y){let l=this.getUser(c);if(!l)throw new Error(`${c} does not exist`);return Array.isArray(y)||(y=[y]),y.forEach(k=>l.addTask(new ke(k))),V(this,F,Q).call(this),y}editUserTask(c,y,l){const k=this.getUser(c);if(!k)throw new Error(`${c} has no tasks`);return k.editTask(y,l),V(this,F,Q).call(this),l}completeUserTasks(c,y){const l=this.getUser(c);if(!l)throw new Error(`${c} has no tasks`);Array.isArray(y)||(y=[y]);const k=y.map(T=>l.completeTask(T).description);return V(this,F,Q).call(this),k}deleteUserTasks(c,y){const l=this.getUser(c);if(!l)throw new Error(`${c} has no tasks`);Array.isArray(y)||(y=[y]);const k=l.deleteTask(y).map(T=>T.description);return V(this,F,Q).call(this),k}checkUserTasks(c){const y=this.getUser(c);if(!y)throw new Error(`${c} has no tasks`);return y.getTasks().filter(l=>!l.isComplete()).map(l=>l.getDescription())}clearUserList(){this.users=[],V(this,F,Q).call(this)}clearDoneTasks(){this.users.forEach(c=>{c.clearDoneTasks()}),V(this,F,Q).call(this)}deleteUser(c){const y=this.users.findIndex(k=>k.username===c);if(y===-1)throw new Error(`${c} not found`);const l=this.users[y];return this.users.splice(y,1),V(this,F,Q).call(this),l}}le=new WeakSet,Oe=function(){let c=localStorage.getItem("userList");return c?(c=JSON.parse(c),c.map(l=>{const k=new we(l.username,{userColor:l.userColor});return l.tasks.map(T=>{k.addTask(new ke(T.description)).setCompletionStatus(T.completionStatus)}),k})):(c=[],localStorage.setItem("userList",JSON.stringify(c)),c)},F=new WeakSet,Q=function(){localStorage.setItem("userList",JSON.stringify(this.users))};function Pe(){const S=document.querySelector(":root");for(let[c,y]of Object.entries(configs.styles))c.includes("FontFamily")&&je(y),S.style.setProperty(Ne(c),y)}function je(S){WebFont.load({google:{families:[`${S}:100,400,700`]}})}function Ne(S){return`--${S.replace(/([A-Z])/g,"-$1").toLowerCase()}`}function Ue(){const S=["!add","!edit","!done","!delete","!taskhelp"],c=document.querySelector(".command-code");let y=0;setInterval(()=>{c.style.opacity=0,setTimeout(()=>{c.innerText=S[y],c.style.opacity=1,y=(y+1)%S.length},1e3)},7e3)}let ne,pe;function Ce(){const c=document.querySelector(".task-wrapper").clientHeight,y=document.querySelector(".task-container.primary"),l=y.scrollHeight,k=document.querySelector(".task-container.secondary");if(l<c)k.style.display="none",$e();else{k.style.display="flex";const T=configs.settings.scrollSpeed;let _=parseInt(T,10),s={duration:l/_*1e3,iterations:1,easing:"linear"};const a=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);let h=l+parseInt(a,10),t=[{transform:"translateY(0)"},{transform:`translateY(-${h}px)`}],o=[{transform:"translateY(0)"},{transform:`translateY(-${h}px)`}];ne=y.animate(t,s),pe=k.animate(o,s),Ge()}}function $e(){ne&&ne.cancel(),pe&&pe.cancel()}function Ge(){ne&&(ne.addEventListener("finish",Te),ne.addEventListener("cancel",Te))}function Te(){Ce()}function Se(S){const c=document.createDocumentFragment();let y=0,l=0;S.forEach(s=>{const a=document.createElement("div");a.classList.add("card");const h=document.createElement("div");h.classList.add("username"),h.innerText=s.username,h.style.color=configs.settings.showUsernameColor?s.userColor:"",a.appendChild(h);const t=document.createElement("ol");t.classList.add("tasks"),s.tasks.forEach(o=>{const f=document.createElement("li");f.classList.add("task"),f.innerText=o.description,o.completionStatus&&(f.classList.add("done"),l++),y++,t.appendChild(f)}),a.appendChild(t),c.appendChild(a)});const k=document.querySelector(".task-count");k.innerText=`${l}/${y}`;const T=c.cloneNode(!0),_=document.querySelector(".task-container.primary");_.innerHTML="",_.appendChild(c);const p=document.querySelector(".task-container.secondary");p.innerHTML="",p.appendChild(T),Ce()}function He(){const S=[];for(let c=1;c<=6;c++){const y=`Username${c}`,l=["red","royalBlue","springGreen","lightSeaGreen","goldenRod","violet"],k=l[Math.floor(Math.random()*l.length)],T={username:y,userColor:k,tasks:[{description:"Task 1 description",completionStatus:!0},{description:"This is task 2 description",completionStatus:!0},{description:"This description is a longer description task",completionStatus:!1}]};S.push(T)}return S}function Je(S,c,y,l,k){c=`!${c.toLowerCase()}`;const{admin:T,user:_,settings:{languageCode:p,maxTasksPerUser:s}}=window.configs,a=window.userList;let h="",t="";try{if(qe(l)){if(T.commands.clearList.includes(c))return a.clearUserList(),h=T.responseTo[p].clearList,ie(h,S,t);if(T.commands.clearDone.includes(c))return a.clearDoneTasks(),h=T.responseTo[p].clearDone,ie(h,S,t);if(T.commands.clearUser.includes(c))return a.deleteUser(y),t=y,h=T.responseTo[p].clearUser,ie(h,S,t)}if(_.commands.addTask.includes(c)){if(y==="")throw new Error("Task description is empty");let o=a.getUser(S);o||(o=a.createUser(S,{userColor:k.userColor}));const f=y.split(", ");o.getTasks().length+f.length>s?h=_.responseTo[p].maxTasksAdded:(t=a.addUserTasks(S,f).join(", "),h=_.responseTo[p].addTask)}else if(_.commands.editTask.includes(c)){const o=y.search(new RegExp("(?<=\\d)\\s"));if(o===-1)throw new Error("Task number or description format is invalid");const f=y.slice(o+1),i=y.slice(0,o);a.editUserTask(S,ge(i),f),t=i,h=_.responseTo[p].editTask}else if(_.commands.finishTask.includes(c)){const o=ge(y);t=a.completeUserTasks(S,o),h=_.responseTo[p].finishTask}else if(_.commands.deleteTask.includes(c)){const o=ge(y);t=a.deleteUserTasks(S,o),h=_.responseTo[p].deleteTask}else if(_.commands.check.includes(c))t=a.checkUserTasks(S).join(", "),t===""?h=_.responseTo[p].noTaskFound:h=_.responseTo[p].check;else if(_.commands.help.includes(c))h=_.responseTo[p].help;else if(_.commands.additional.includes(c))h=_.responseTo[p].additional;else throw new Error("command not found");return ie(h,S,t)}catch(o){return ie(_.responseTo[p].invalidCommand,S,o.message)}}function ie(S,c,y){return S.replace("{user}",c).replace("{message}",y)}function qe(S){return S.broadcaster||S.mod}function ge(S){return parseInt(S,10)-1}const{twitch_channel:Fe,twitch_oauth:Be,twitch_username:We}=configs.auth;window.addEventListener("load",()=>{window.userList=new Me,Pe(),Ue(),configs.settings.testMode&&(window.userList.users=He()),fe.Init(We,Be,[Fe]),fe.onCommand=(S,c,y,l,k)=>{const T=Je(S,c,y,l,k);fe.Say(T),Se(window.userList.users)},Se(window.userList.users)})})();
