var Z=(p,m,w)=>{if(!m.has(p))throw TypeError("Cannot "+w)};var I=(p,m,w)=>{if(m.has(p))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(p):m.set(p,w)};var k=(p,m,w)=>(Z(p,m,"access private method"),w);(function(){"use strict";var S,$,f,g;class p{constructor(e,s){this.username=this.validateUsername(e),this.userColor=(s==null?void 0:s.userColor)||"",this.tasks=[]}validateUsername(e){if(typeof e!="string")throw new Error("Username must be of type string");if(e=e.trim(),e.length===0)throw new Error("Username invalid");return e}addTask(e){return this.tasks.push(e),e}editTask(e,s){let t=this.getTask(e);return t.setDescription(s),t}completeTask(e){let s=this.getTask(e);return s.setCompletionStatus(!0),s}deleteTask(e){Array.isArray(e)||(e=[e]),e.forEach(t=>this.validateTaskIndex(t));const s=[];return this.tasks=this.tasks.filter((t,o)=>{if(e.includes(o))s.push(t);else return!0}),s}clearDoneTasks(){return this.tasks=this.tasks.filter(e=>!e.isComplete()),this.tasks}getTask(e){return this.validateTaskIndex(e),this.tasks[e]}getTasks(){return this.tasks}validateTaskIndex(e){if(typeof e!="number"||isNaN(e))throw new Error("Task index must be a number");if(e<0||e>=this.tasks.length)throw new Error("Task index out of bounds");return!0}}class m{constructor(e){this.description=this.validateDescription(e),this.completionStatus=!1}validateDescription(e){if(typeof e!="string")throw new Error("Task description must be of type string");if(e=e.trim(),e.length===0)throw new Error("Task description invalid");return e}getDescription(){return this.description}setDescription(e){this.description=this.validateDescription(e)}isComplete(){return this.completionStatus}setCompletionStatus(e){if(typeof e!="boolean")throw new Error("Completion status must be of type boolean");this.completionStatus=e}}class w{constructor(){I(this,S);I(this,f);this.users=k(this,S,$).call(this)}getUser(e){return this.users.find(t=>t.username===e)}getAllUsers(){return this.users}createUser(e,s){if(this.getUser(e))throw new Error(`${e} already exists`);const t=new p(e,s);return this.users.push(t),t}addUserTasks(e,s){let t=this.getUser(e);if(!t)throw new Error(`${e} does not exist`);return Array.isArray(s)||(s=[s]),s.forEach(o=>t.addTask(new m(o))),k(this,f,g).call(this),s}editUserTask(e,s,t){const o=this.getUser(e);if(!o)throw new Error(`${e} has no tasks`);return o.editTask(s,t),k(this,f,g).call(this),t}completeUserTasks(e,s){const t=this.getUser(e);if(!t)throw new Error(`${e} has no tasks`);Array.isArray(s)||(s=[s]);const o=s.map(r=>t.completeTask(r).description);return k(this,f,g).call(this),o}deleteUserTasks(e,s){const t=this.getUser(e);if(!t)throw new Error(`${e} has no tasks`);Array.isArray(s)||(s=[s]);const o=t.deleteTask(s).map(r=>r.description);return k(this,f,g).call(this),o}checkUserTasks(e){const s=this.getUser(e);if(!s)throw new Error(`${e} has no tasks`);return s.getTasks().filter(t=>!t.isComplete()).map(t=>t.getDescription())}clearUserList(){this.users=[],k(this,f,g).call(this)}clearDoneTasks(){this.users.forEach(e=>{e.clearDoneTasks()}),k(this,f,g).call(this)}deleteUser(e){const s=this.users.findIndex(o=>o.username===e);if(s===-1)throw new Error(`${e} not found`);const t=this.users[s];return this.users.splice(s,1),k(this,f,g).call(this),t}}S=new WeakSet,$=function(){let e=localStorage.getItem("userList");return e?(e=JSON.parse(e),e.map(t=>{const o=new p(t.username,{userColor:t.userColor});return t.tasks.map(r=>{o.addTask(new m(r.description)).setCompletionStatus(r.completionStatus)}),o})):(e=[],localStorage.setItem("userList",JSON.stringify(e)),e)},f=new WeakSet,g=function(){localStorage.setItem("userList",JSON.stringify(this.users))};function A(){const n=document.querySelector(":root");for(let[e,s]of Object.entries(configs.styles))e.includes("FontFamily")&&O(s),n.style.setProperty(R(e),s)}function O(n){WebFont.load({google:{families:[`${n}:100,400,700`]}})}function R(n){return`--${n.replace(/([A-Z])/g,"-$1").toLowerCase()}`}function D(){const n=["!add","!edit","!done","!delete","!taskhelp"],e=document.querySelector(".command-code");let s=0;setInterval(()=>{e.style.opacity=0,setTimeout(()=>{e.innerText=n[s],e.style.opacity=1,s=(s+1)%n.length},1e3)},7e3)}let y,b;function U(){const e=document.querySelector(".task-wrapper").clientHeight,s=document.querySelector(".task-container.primary"),t=s.scrollHeight,o=document.querySelector(".task-container.secondary");if(t<e)o.style.display="none",N();else{o.style.display="flex";const r=configs.settings.scrollSpeed;let a=parseInt(r,10),u={duration:t/a*1e3,iterations:1,easing:"linear"};const h=getComputedStyle(document.documentElement).getPropertyValue("--card-gap-between").slice(0,-2);let i=t+parseInt(h,10),c=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}],d=[{transform:"translateY(0)"},{transform:`translateY(-${i}px)`}];y=s.animate(c,u),b=o.animate(d,u),M()}}function N(){y&&y.cancel(),b&&b.cancel()}function M(){y&&(y.addEventListener("finish",L),y.addEventListener("cancel",L))}function L(){U()}function x(n){const e=document.createDocumentFragment();let s=0,t=0;n.forEach(u=>{const h=document.createElement("div");h.classList.add("card");const i=document.createElement("div");i.classList.add("username"),i.innerText=u.username,i.style.color=configs.settings.showUsernameColor?u.userColor:"",h.appendChild(i);const c=document.createElement("ol");c.classList.add("tasks"),u.tasks.forEach(d=>{const T=document.createElement("li");T.classList.add("task"),T.innerText=d.description,d.completionStatus&&(T.classList.add("done"),t++),s++,c.appendChild(T)}),h.appendChild(c),e.appendChild(h)});const o=document.querySelector(".task-count");o.innerText=`${t}/${s}`;const r=e.cloneNode(!0),a=document.querySelector(".task-container.primary");a.innerHTML="",a.appendChild(e);const l=document.querySelector(".task-container.secondary");l.innerHTML="",l.appendChild(r),U()}function G(){const n=[];for(let e=1;e<=10;e++){const s=`Username${e}`,o=["red","coral","springGreen","lightSeaGreen","slateBlue","hotpink","violet","orange","darkTurquoise","dodgerblue","blueviolet"][e-1],r={username:s,userColor:o,tasks:[{description:"Task 1 description",completionStatus:!0},{description:"This is task 2 description",completionStatus:!0},{description:"This description is a longer description task",completionStatus:!1}]};n.push(r)}return n}function F(n,e,s,t,o){e=`!${e.toLowerCase()}`;const{admin:r,user:a,settings:{languageCode:l,maxTasksPerUser:u}}=window.configs,h=window.userList;let i="",c="";try{if(H(t)){if(r.commands.clearList.includes(e))return h.clearUserList(),i=r.responseTo[l].clearList,C(i,n,c);if(r.commands.clearDone.includes(e))return h.clearDoneTasks(),i=r.responseTo[l].clearDone,C(i,n,c);if(r.commands.clearUser.includes(e))return h.deleteUser(s),c=s,i=r.responseTo[l].clearUser,C(i,n,c)}if(a.commands.addTask.includes(e)){if(s==="")throw new Error("Task description is empty");let d=h.getUser(n);d||(d=h.createUser(n,{userColor:o.userColor}));const T=s.split(", ");d.getTasks().length+T.length>u?i=a.responseTo[l].maxTasksAdded:(c=h.addUserTasks(n,T).join(", "),i=a.responseTo[l].addTask)}else if(a.commands.editTask.includes(e)){const d=s.search(new RegExp("(?<=\\d)\\s"));if(d===-1)throw new Error("Task number or description format is invalid");const T=s.slice(d+1),E=s.slice(0,d);h.editUserTask(n,P(E),T),c=E,i=a.responseTo[l].editTask}else if(a.commands.finishTask.includes(e)){const d=P(s);c=h.completeUserTasks(n,d),i=a.responseTo[l].finishTask}else if(a.commands.deleteTask.includes(e)){const d=P(s);c=h.deleteUserTasks(n,d),i=a.responseTo[l].deleteTask}else if(a.commands.check.includes(e))c=h.checkUserTasks(n).join(", "),c===""?i=a.responseTo[l].noTaskFound:i=a.responseTo[l].check;else if(a.commands.help.includes(e))i=a.responseTo[l].help;else if(a.commands.additional.includes(e))i=a.responseTo[l].additional;else throw new Error("command not found");return C(i,n,c)}catch(d){return C(a.responseTo[l].invalidCommand,n,d.message)}}function C(n,e,s){return n.replace("{user}",e).replace("{message}",s)}function H(n){return n.broadcaster||n.mod}function P(n){return parseInt(n,10)-1}function q(n){let e={tags:null,source:null,command:null,parameters:null},s=0,t=null,o=null,r=null,a=null;if(n[s]==="@"){let u=n.indexOf(" ");t=n.slice(1,u),s=u+1}if(n[s]===":"){s+=1;let u=n.indexOf(" ",s);o=n.slice(s,u),s=u+1}let l=n.indexOf(":",s);return l==-1&&(l=n.length),r=n.slice(s,l).trim(),l!=n.length&&(s=l+1,a=n.slice(s)),e.command=V(r),e.command==null?null:(t!=null&&(e.tags=J(t)),e.source=Y(o),e.parameters=a,a&&a[0]==="!"&&(e.command=j(a,e.command)),e)}function J(n){const e={"client-nonce":null,flags:null};let s={};return n.split(";").forEach(o=>{let r=o.split("="),a=r[1]===""?null:r[1];switch(r[0]){case"badges":case"badge-info":if(a){let u={};a.split(",").forEach(i=>{let c=i.split("/");u[c[0]]=c[1]}),s[r[0]]=u}else s[r[0]]=null;break;case"emotes":if(a){let u={};a.split("/").forEach(i=>{let c=i.split(":"),d=[];c[1].split(",").forEach(E=>{let v=E.split("-");d.push({startPosition:v[0],endPosition:v[1]})}),u[c[0]]=d}),s[r[0]]=u}else s[r[0]]=null;break;case"emote-sets":let l=a.split(",");s[r[0]]=l;break;default:e.hasOwnProperty(r[0])||(s[r[0]]=a)}}),s}function V(n){let e=null;switch(commandParts=n.split(" "),commandParts[0]){case"JOIN":case"PART":case"NOTICE":case"CLEARCHAT":case"HOSTTARGET":case"PRIVMSG":e={command:commandParts[0],channel:commandParts[1]};break;case"PING":e={command:commandParts[0]};break;case"CAP":e={command:commandParts[0],isCapRequestEnabled:commandParts[2]==="ACK"};break;case"GLOBALUSERSTATE":e={command:commandParts[0]};break;case"USERSTATE":case"ROOMSTATE":e={command:commandParts[0],channel:commandParts[1]};break;case"RECONNECT":console.log("The Twitch IRC server is about to terminate the connection for maintenance."),e={command:commandParts[0]};break;case"421":return console.log(`Unsupported IRC command: ${commandParts[2]}`),null;case"001":e={command:commandParts[0],channel:commandParts[1]};break;case"002":case"003":case"004":case"353":case"366":case"372":case"375":case"376":return console.log(`numeric message: ${commandParts[0]}`),null;default:return console.log(`
Unexpected command: ${commandParts[0]}
`),null}return e}function Y(n){if(n==null)return null;{let e=n.split("!");return{nick:e.length==2?e[0]:null,host:e.length==2?e[1]:e[0]}}}function j(n,e){let t=n.slice(0+1).trim(),o=t.indexOf(" ");return o==-1?e.botCommand=t.slice(0):(e.botCommand=t.slice(0,o),e.botCommandParams=t.slice(o).trim()),e}class K{constructor(){this.events=new Map}on(e,s){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(s)}emit(e,...s){this.events.has(e)&&this.events.get(e).forEach(t=>t(...s))}off(e,s){if(this.events.has(e)){const t=this.events.get(e),o=t.indexOf(s);o!==-1&&(t.splice(o,1),t.length===0&&this.events.delete(e))}}once(e,s){const t=(...o)=>{s(...o),this.off(e,t)};this.on(e,t)}}class W extends K{constructor({username:e,authToken:s,channel:t}){super(),this.username=e,this.authToken=s,this.channel=t,this.ws=null}connect(e="ws://irc-ws.chat.twitch.tv:80"){this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("Connected to Twitch IRC"),this.ws.send(`PASS ${this.authToken}`),this.ws.send(`NICK ${this.username}`),this.ws.send(`JOIN #${this.channel}`)},this.ws.onerror=s=>{console.error("Error connecting to Twitch IRC",s)},this.ws.onmessage=s=>{this.handleMessage(s.data)},this.ws.onclose=()=>{console.log("Disconnected from Twitch IRC")}}say(e){this.ws.readyState===WebSocket.OPEN?this.ws.send(`PRIVMSG #${this.channel} :${e}`):console.error("Connection is not open")}handleMessage(e){if(console.log(e),e.type==="utf8"){let s=e.utf8Data.trimEnd();console.log(`Message received (${new Date().toISOString()}): '${s}'
`),s.split(`\r
`).forEach(o=>{debugger;let r=q(o);if(r)switch(console.log(`Message command: ${r.command.command}`),console.log(`
${JSON.stringify(r,null,3)}`),r.command.command){case"PRIVMSG":this.emit("message",r);break;case"PING":console.log("Received PING from server"),this.ws.send("PONG "+r.parameters);break;case"001":this.ws.send(`JOIN ${channel}`);break;case"JOIN":this.ws.send(`PRIVMSG ${channel} :JOIN CASE`);break;case"PART":console.log("The channel must have banned (/ban) the bot."),this.ws.close();break;case"NOTICE":r.parameters==="Login authentication failed"?(console.log(`Authentication failed; left ${channel}`),this.ws.send(`PART ${channel}`)):r.parameters==="You don't have permission to perform that action"&&(console.log(`No permission. Check if the access token is still valid. Left ${channel}`),this.ws.send(`PART ${channel}`));break}})}}close(){this.ws&&this.ws.close()}}const{twitch_channel:_,twitch_oauth:B,twitch_username:z}=configs.auth;window.addEventListener("load",()=>{window.userList=new w,A(),D(),configs.settings.testMode&&(window.userList.users=G());const n=new W({username:z,authToken:B,channel:_});n.on("message",e=>{const s=F(tags.username,e);n.say(s),x(window.userList.users)}),n.connect(),x(window.userList.users)})})();
